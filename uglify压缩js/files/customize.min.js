var allLanguage=top.languageInit.allLanguage,deleted=allLanguage.delete,disable=top.languageInit.allLanguage.disable,copy=top.languageInit.allLanguage.copy,findBack=top.languageInit.allLanguage.findBack;function cusdatetimepicker(a){$(".fa-calendar").remove(),void 0==a&&(a=$(document)),a.find(".datepicker").length>0&&a.find(".datepicker").datepicker({changeMonth:!0,changeYear:!0,yearRange:"1920:2099",minDate:new Date("1920-01-01"),maxDate:new Date("2099-12-31"),dateFormat:"yy-mm-dd",showOn:"button",buttonImage:"./../../../../api-b/img/icon/date.jpg",buttonImageOnly:!0}),a.find(".datetimepicker").length>0&&a.find(".datetimepicker").datetimepicker({changeMonth:!0,changeYear:!0,yearRange:"1920:2099",minDate:new Date("1920-01-01 00:00"),maxDate:new Date("2099-12-31 23:59"),dateFormat:"yy-mm-dd",showOn:"button",buttonImage:"./../../../../api-b/img/icon/date.jpg",buttonImageOnly:!0}),a.find(".timepicker").length>0&&a.find(".timepicker").timepicker({showOn:"button",buttonImage:"./../../../../api-b/img/icon/date.jpg",buttonImageOnly:!0,beforeShow:function(a){if((-1!=$(a).attr("name").indexOf("startDate")||-1!=$(a).attr("name").indexOf("endDate"))&&-1!=$(a).attr("name").indexOf("EngineeringWorkHours")&&-1==$(a).attr("name").indexOf("EngineeringWorkHours[0].startDate")&&""==$(a).closest("tbody").find('[name="EngineeringWorkHours[0].startDate"]').val())return top.layer.alert(top.languageInit.allLanguage.selectFirstStartTime,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1}}),$(".ui-datepicker-trigger").each(function(){$(this).prev().is(":disabled")&&$(this).addClass("divDisabled")})}function cusImport(a){console.log(a),layui.use(["element","upload"],function(){element=layui.element,upload=layui.upload;var e=a;upload.render({elem:"#uploadExcel",url:e,accept:"file",multiple:!0,done:function(a){console.log(a),200==a.header.status?top.layer.msg("成功！",{time:3e3}):top.layer.alert(a.header.statusContent)}})})}function upload(a,e,t){layui.use("upload",function(){var n=layui.upload,i=$("#demoList"),l=editParm5(),o="",r="";"image"==(l=l==top.languageInit.allLanguage.picup?"image":l==top.languageInit.allLanguage.uploadJobGuide?"noImage":"all")?(o="images",r=".jpg,.png,.gif,.jpeg"):"noImage"==l?(o="file",r=".pdf,.txt,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.rar,.zip,.7z"):"all"==l&&(o="file",r=".jpg,.png,.gif,.jpeg,.pdf,.txt,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.rar,.zip,.7z"),uploadListIns=n.render({elem:"#testList",url:t,size:1024,accept:o,acceptMime:r,data:{generalId:a,pageKey:e},multiple:!0,auto:!1,bindAction:"#testListAction",choose:function(a){this.files=a.pushFile();a.preview(function(e,t,n){if(console.log(t),0==t.size)return top.layer.alert(top.languageInit.allLanguage.uploadNotEmpty,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;var l=$(['<tr id="upload-'+e+'">',"<td>"+t.name+"</td>","<td>"+(t.size/1024).toFixed(1)+"kb</td>","<td>"+top.languageInit.allLanguage.waitForUpload+"</td>","<td>",'<button class="layui-btn layui-btn-xs demo-view layui-hide">'+top.languageInit.allLanguage.view+"</button>",'<button class="layui-btn layui-btn-xs demo-reload layui-hide">'+top.languageInit.allLanguage.returnMission+"</button>",'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">'+top.languageInit.allLanguage.delete+"</button>","</td>","<td></td>","</tr>"].join(""));l.find(".demo-reload").on("click",function(){a.upload(e,t)}),i.append(l)})},done:function(a,e,t){if(console.log(JSON.stringify(a)),"1"==a.code)return(n=i.find("tr#upload-"+e).children()).eq(2).html('<span style="color: #5FB878;">'+top.languageInit.allLanguage.upSuccess+"</span>"),n.eq(3).find(".demo-view").removeClass("layui-hide"),n.eq(3).find(".demo-view").attr("url",a.object.url),n.eq(4).text(a.object.id),delete this.files[e];var n=i.find("tr#upload-"+e).children();"3"==a.code?n.eq(2).html('<span style="color: #FF5722;">'+top.languageInit.allLanguage.contentRepeat+"</span>"):n.eq(2).html('<span style="color: #FF5722;">'+top.languageInit.allLanguage.upLoadFail+"</span>")},error:function(a,e){var t=i.find("tr#upload-"+a).children();t.eq(2).html('<span style="color: #FF5722;">'+top.languageInit.allLanguage.upLoadFail+"</span>"),t.eq(3).find(".demo-reload").removeClass("layui-hide")}})}),$("#testListAction").click(function(){0==$("#demoList tr").length&&top.layer.alert(top.languageInit.allLanguage.selectFileAndUpload,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info})})}function attView(){$(document).on("click",".demo-view",function(){var a=(t=$(this).attr("url")).split("."),e=a.slice(Number(a.length)-1);if("jpg"!=e&&"png"!=e&&"gif"!=e&&"jpeg"!=e&&"pdf"!=e){let a=document.createElement("a");return a.style.display="none",a.download=$(this).closest("tr").find("td").eq(0).text(),a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),!1}var t=$(this).attr("url");top.layer.open({type:2,title:!1,closeBtn:0,area:["800px","600px"],skin:"layui-layer-nobg",shadeClose:!0,content:t,success:function(a){a.find("iframe").contents().find("body img").wrap("<div class='imgWrap' style='display:flex;justify-content:center;align-items:center;'></div>");var e=a.find("iframe").contents().find("body img").width(),t=a.find("iframe").contents().find("body img").height();e>.8*screen.availWidth&&(a.find("iframe").contents().find("body img").width(.8*screen.availWidth),a.find("iframe").contents().find("body img").height()>.8*screen.availHeight&&(a.find("iframe").contents().find("body img").height(parseInt(.8*screen.availHeight)),a.find("iframe").contents().find("body img").width("auto"),a.find("iframe").contents().find("body img").width(parseInt(a.find("iframe").contents().find("body img").width())))),e=a.find("iframe").contents().find("body img").width();var n=(600-(t=a.find("iframe").contents().find("body img").height()))/2+parseFloat(a.css("top")),i=(800-e)/2+parseFloat(a.css("left"));a.css({width:e,height:t,top:n,left:i}),a.find("iframe").css({width:e,height:t,top:n,left:i})}})})}function attDel(){$(document).on("click",".demo-delete",function(){var a=$(this).closest("tr"),e=a.find("td:last-child").text(),t=editParm3(),n=editParm4(),i=testDomainName+"/api-b/commonRoute/deleteFile/"+e+"/"+t+"/"+n;top.layer.confirm(top.languageInit.allLanguage.sureToDelete,{btn:[top.languageInit.allLanguage.sure,top.languageInit.allLanguage.cancelSet],title:top.languageInit.allLanguage.info},function(t,n){a.remove(),""!=e&&$.ajax({url:i,type:"get",dataType:"json",contentType:"application/json",async:!1,success:function(a){top.layer.msg(top.languageInit.allLanguage.success)},error:function(){top.layer.msg(top.languageInit.allLanguage.fail)}}),top.layer.close(t)},function(a){})})}function areaChange(a){$(document).on("change",'[name$=".country"],[name$=".area"],[name$=".province"],[name$=".city"]',function(){var e=$(this),t=$(this).val(),n=$(this).attr("name").split(".")[1],i=e.closest(".custabcons"),l=i.find('[name$=".area"]'),o=i.find('[name$=".province"]'),r=i.find('[name$=".city"]');"country"==n?(l.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>"),o.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>"),r.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>")):"area"==n?(o.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>"),r.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>")):"province"==n&&r.html("<option value=0>"+top.languageInit.allLanguage.pleaseChoose+"</option>"),i.find('[name$=".'+n+'Id"]').val(t),$.ajax({url:a+t,type:"get",dataType:"json",contentType:"application/json",success:function(a){console.log(a),"string"==typeof a&&(a=JSON.parse(a)),$.each(a,function(a,e){"country"==n?l.append("<option value="+e.id+">"+e.name+"</option>"):"area"==n?o.append("<option value="+e.id+">"+e.name+"</option>"):"province"==n&&r.append("<option value="+e.id+">"+e.name+"</option>")})},error:function(){alert(top.languageInit.allLanguage.errorLinkage)}})})}function rowData(a){var e="",t=(e=0!=$(a).closest("body").find("iframe[src*='search']").length?$(a).closest("body").find("iframe[src*='search']").contents().find("#list"):$(a).closest("body").find("#list")).jqGrid("getGridParam","selarrrow");return t.length>1?(top.layer.alert(top.languageInit.allLanguage.onlyChooseOne,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):0==t.length?(top.layer.alert(top.languageInit.allLanguage.pleaseChooseOne,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):e.jqGrid("getRowData",t)}function closetab(){top.$(".layui-tab-title>.layui-this>.layui-tab-close").click()}function codeRule(){$('select[name^="CodeRuleDetail["]').filter('select[name$=".type"]').length>0&&$('select[name^="CodeRuleDetail["]').filter('select[name$=".type"]').each(function(a,e){var t=$(this).closest("tr");t.find("input:text").attr("readonly","readonly"),t.find(".back").addClass("divDisabled"),t.find(".back").closest("td").removeClass("edit-inline"),t.find("select:not([name$='.type'])").attr("disabled","disabled");var n=$(this).val();if("1"==n)var i=["setValue","codeSeparator"];else if("2"==n)i=["source","format","codeSeparator","codeBasis"];else if("3"==n)i=["source","length","codeSeparator","codeBasis"];else if("4"==n)i=["length","codeSeparator"];else if("5"==n)i=["startValue","stepSize","codeSeparator","length"];if($.each(i,function(a,e){t.find('[name$="'+e+'"]').removeAttr("readonly"),t.find('[name$="'+e+'"]').removeAttr("disabled"),t.find('[name$="'+e+'"]').next().removeClass("divDisabled")}),"2"==n){var l=""==t.find('[name$="length"]').val()?"10":t.find('[name$="length"]').val();t.find('[name$="length"]').val(l);var o=""==t.find('[name$="format"]').val()?"YYYY.MM.dd":t.find('[name$="format"]').val();t.find('[name$="format"]').val(o)}else if("5"==n){var r=""==t.find('[name$="startValue"]').val()?"1":t.find('[name$="startValue"]').val();t.find('[name$="startValue"]').val(r);var s=""==t.find('[name$="stepSize"]').val()?"1":t.find('[name$="stepSize"]').val();t.find('[name$="stepSize"]').val(s)}});$(document).on("change",'select[name$=".type"]',function(){var a=$(this).closest("tr");a.find("input:text").attr("readonly","readonly"),a.find(".back").addClass("divDisabled"),a.find(".back").closest("td").removeClass("edit-inline"),a.find("select:not([name$='.type'])").attr("disabled","disabled");var e=$(this).val();if("1"==e)var t=["setValue","codeSeparator"];else if("2"==e)t=["source","format","codeSeparator","codeBasis"];else if("3"==e)t=["source","length","codeSeparator","codeBasis"];else if("4"==e)t=["source","length","codeSeparator","codeBasis","sourceProperty"];else if("5"==e)t=["startValue","stepSize","codeSeparator","length"];$.each(t,function(e,t){a.find('[name$="'+t+'"]').removeAttr("readonly"),a.find('[name$="'+t+'"]').removeAttr("disabled"),a.find('[name$="'+t+'"]').next().removeClass("divDisabled")}),a.find("input:text").val(""),"2"==e?(a.find('[name$="length"]').val("10"),a.find('[name$="format"]').val("YYYY.MM.dd")):"5"==e&&(a.find('[name$="startValue"]').val("1"),a.find('[name$="stepSize"]').val("1"),a.find('[name$="length"]').val("4"))}),$(document).on("keyup",'[name$=".setValue"]',function(){$(this).closest("tr").find('[name$=".length"]').val($(this).val().length)})}function codingExample(){var a="",e=$('[name^="CodeRuleDetail"]:visible, [name^="OtherCodeRuleDetail"]:visible').filter('[name$="type"]').not("th");if(e.length>0){var t=0;return e.eq(0).closest("tbody").find("tr").each(function(n,i){var l=e.eq(0).closest("tbody").find("tr").length,o=$(i).find('[name$="type"]').val(),r=$(i).find('[name$="type"]').attr("name").split("[")[0],s=$(i).find('[name$="codeSeparator"]').val();if(1==o)var d=$(i).find('[name$="setValue"]').val();else if(2==o||"OtherCodeRuleDetail"==r&&3==o)d=$(i).find('[name$="format"]').val();else if("CodeRuleDetail"==r&&3==o||"OtherCodeRuleDetail"==r&&4==o||"OtherCodeRuleDetail"==r&&6==o||"OtherCodeRuleDetail"==r&&7==o){var u=$(i).find('[name$="length"]').val();d="测试文本测试文本测试";"OtherCodeRuleDetail"==r&&(4==o?d="供应商名称供应商名称":6==o?d="客户客户客户客户客户":7==o&&(d="部门部门部门部门部门")),u<d.length&&(d=d.substr(0,u))}else if("CodeRuleDetail"==r&&4==o){(u=$(i).find('[name$="length"]').val())<(d="WL00000001").length&&(d=d.substr(0,u))}else if(5==o){(u=$(i).find('[name$="length"]').val())<(d="0000000001").length&&(d=d.substr(d.length-u,d.length))}a+=n==l-1?d:d+s;u=$(i).find('[name$="length"]').val();var c=(s=$(i).find('[name$="codeSeparator"]').val()).length;""==u&&(u=0),""==s&&(c=0),n==l-1&&(c=0),t=t+Number(u)+Number(c)}),console.log(a),e.eq(0).closest(".custabcons").find('[name$="totalLength"]').val(t),t>30?(top.layer.alert(top.languageInit.allLanguage.totalLengthCannotExceed,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):(e.eq(0).closest(".custabcons").find('[name$="codeDemo"]').val(a),!0)}}function otherCodeRule(){$('select[name^="OtherCodeRuleDetail["]').filter('select[name$=".type"]').length>0&&$('select[name^="OtherCodeRuleDetail["]').filter('select[name$=".type"]').each(function(a,e){var t=$(this).closest("tr");t.find("input:text").attr("readonly","readonly"),t.find(".back").addClass("divDisabled"),t.find(".back").closest("td").removeClass("edit-inline"),t.find("select:not([name$='.type'])").attr("disabled","disabled");var n=$(this).val();if("1"==n)var i=["codeSeparator","setValue"];else if("2"==n)i=["format","codeSeparator","codeBasis"];else if("3"==n)i=["format","codeSeparator","codeBasis"];else if("4"==n)i=["length","codeSeparator"];else if("5"==n)i=["length","codeSeparator","codeBasis"];else if("6"==n)i=["length","codeSeparator"];else if("7"==n)i=["length","codeSeparator"];if($.each(i,function(a,e){t.find('[name$="'+e+'"]').removeAttr("readonly"),t.find('[name$="'+e+'"]').removeAttr("disabled"),t.find('[name$="'+e+'"]').next().removeClass("divDisabled")}),"2"==n||"3"==n){var l=""==t.find('[name$="length"]').val()?"10":t.find('[name$="length"]').val();t.find('[name$="length"]').val(l);var o=""==t.find('[name$="format"]').val()?"YYYY.MM.dd":t.find('[name$="format"]').val();t.find('[name$="format"]').val(o)}});$(document).on("change",'select[name$=".type"]',function(){var a=$(this).closest("tr");a.find("input:text").attr("readonly","readonly"),a.find(".back").addClass("divDisabled"),a.find(".back").closest("td").removeClass("edit-inline"),a.find("select:not([name$='.type'])").attr("disabled","disabled");var e=$(this).val();if("1"==e)var t=["codeSeparator","setValue"];else if("2"==e)t=["format","codeSeparator","codeBasis"];else if("3"==e)t=["format","codeSeparator","codeBasis"];else if("4"==e)t=["length","codeSeparator"];else if("5"==e)t=["length","codeSeparator","codeBasis"];else if("6"==e)t=["length","codeSeparator"];else if("7"==e)t=["length","codeSeparator"];$.each(t,function(e,t){a.find('[name$="'+t+'"]').removeAttr("readonly"),a.find('[name$="'+t+'"]').removeAttr("disabled"),a.find('[name$="'+t+'"]').next().removeClass("divDisabled")}),"2"!=e&&"3"!=e||(a.find('[name$="length"]').val("10"),a.find('[name$="format"]').val("YYYY.MM.dd"))}),$(document).on("keyup",'[name$=".setValue"]',function(){$(this).closest("tr").find('[name$=".length"]').val($(this).val().length)})}function spTypeInitCheck(a,e,t,n,i){if($('select[name="QualitySamplingPlan.spType"]').length>0){$('select[name="QualitySamplingPlan.spType"]');var l=$('[name="QualitySamplingPlan.spType"]').val(),o=$('input[name="QualitySamplingPlanDetail[0].spBatchDown"]'),r=$('input[name="QualitySamplingPlanDetail[0].spBatchUp"]'),s=$('input[name="QualitySamplingPlanDetail[0].sampleAmount"]'),d=$('input[name="QualitySamplingPlanDetail[0].allowAmount"]'),u=$('input[name="QualitySamplingPlanDetail[0].rejectAmount"]');0==l?(o.attr("check",""),r.attr("check",""),s.attr("check",""),d.attr("check",""),u.attr("check","")):1==l?(o.attr("check",""),r.attr("check",""),d.attr("check",n),u.attr("check",i),s.attr("check",t)):2==l?(o.attr("check",a),r.attr("check",e),d.attr("check",n),u.attr("check",i),s.attr("check",t)):3==l&&(o.attr("check",a),r.attr("check",e),d.attr("check",n),u.attr("check",i),s.attr("check",t))}}function sampling(){if(0!=$('[name="QualitySamplingPlan.spType"]').length){var a=$('input[name$=".spBatchDown"]').attr("check"),e=$('input[name$=".spBatchUp"]').attr("check"),t=$('input[name$=".sampleAmount"]').attr("check"),n=$('input[name$=".allowAmount"]').attr("check"),i=$('input[name$=".rejectAmount"]').attr("check"),l=$('select[name="QualitySamplingPlan.spType"]').val();$('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] table tbody tr').each(function(a,e){$(e).find("input:text").removeAttr("readonly");var t=$(e).find('[name$="spBatchUp"]'),n=$(e).find('[name$="spBatchDown"]');$(e).find('[name$="sampleAmount"]'),$(e).find('[name$="allowAmount"]'),$(e).find('[name$="rejectAmount"]');0==l?$(e).find("input:text").attr("readonly","readonly"):1==l&&(t.attr("readonly","readonly"),n.attr("readonly","readonly"))}),spTypeInitCheck(a,e,t,n,i),$(document).on("change",'select[name="QualitySamplingPlan.spType"]',function(){var l=$(this).val();$('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] table tbody tr').each(function(a,e){$(e).find("input:text").removeAttr("readonly");var t=$(e).find('[name$="spBatchUp"]'),n=$(e).find('[name$="spBatchDown"]');$(e).find('[name$="sampleAmount"]'),$(e).find('[name$="allowAmount"]'),$(e).find('[name$="rejectAmount"]');0==l?($(e).find("input:text").attr("readonly","readonly"),$(e).find("input:text").val("")):1==l&&(t.attr("readonly","readonly"),n.attr("readonly","readonly"),$(e).find("input:text").val(""))}),spTypeInitCheck(a,e,t,n,i)})}}function Inspection2(a,e,t,n,i){-1!=a.indexOf("QualityInspectionPlanDetail")&&-1!=a.indexOf("testName")&&(n.find('[name$="['+i+'].requireValue"]','[name$="['+i+'].rangeDown"]','[name$="['+i+'].rangeUp"]').val("").attr("readonly",!1),"定性"==e[t][a.split(".")[0]+".testJudge"]?n.find('[name$="['+i+'].requireValue"]','[name$="['+i+'].rangeDown"]','[name$="['+i+'].rangeUp"]').attr({readonly:!0,check:""}):4==n.find('[name$="['+i+'].judgeType"]').val()?n.find('[name$="['+i+'].requireValue"]').attr({readonly:!0,check:""}):n.find('[name$="['+i+'].rangeDown"]','[name$="['+i+'].rangeUp"]').attr({readonly:!0,check:""}))}function Inspection(){var a=$('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] table tbody tr'),e=["requireValue","rangeDown","rangeUp"],t=["rangeDown","rangeUp"],n=["requireValue"],i=[],l=a.eq(0);$.each(e,function(a,e){var t=$(l).find('[name$="'+e+'"]').attr("check");i.push(t)}),a.each(function(a,i){$.each(e,function(a,e){$(i).find('[name$="'+e+'"]').removeAttr("readonly")});var l=$(i).find('[name$="judgeType"]').val(),o=$(i).find('[name$="testJudge"]').val();4==l?$.each(n,function(a,e){$(i).find('[name$="'+e+'"]').attr("readonly","readonly").attr("check","")}):$.each(t,function(a,e){$(i).find('[name$="'+e+'"]').attr("readonly","readonly").attr("check","")}),o==top.languageInit.allLanguage.qualitative&&$.each(e,function(a,e){$(i).find('[name$="'+e+'"]').attr("readonly","readonly").attr("check","")})}),$(document).on("change",'select[name$="judgeType"]',function(){var a=$(this).closest("tr");$.each(e,function(e,t){a.find('[name$="'+t+'"]').removeAttr("readonly").attr("check",i[e]),a.find('[name$="'+t+'"]').val(""),a.find('[name$="'+t+'"]').parent("td").removeClass("checkfalse")}),4==$(this).val()?$.each(n,function(e,t){a.find('[name$="'+t+'"]').attr("readonly","readonly").attr("check","")}):$.each(t,function(e,t){a.find('[name$="'+t+'"]').attr("readonly","readonly").attr("check","")}),a.find('[name$="testJudge"]').val()==top.languageInit.allLanguage.qualitative&&$.each(e,function(e,t){a.find('[name$="'+t+'"]').attr("readonly","readonly").attr("check","")})})}function lowerUpperLimit(a,e,t,n){$(document).on("change",'[name$="'+a+'"],[name$="'+e+'"]',function(){var i=$(this),l=$(this).val(),o=i.closest("tr").siblings();i.closest("tbody").find("tr");if(i.is('[name$="'+a+'"]')){var r=parseFloat(i.closest("tr").find('[name$="'+e+'"]').val());if(""==r)return!1;if(l>r)return i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.greaterThanUpperLimit,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;if(l==r)return i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.equalToUpperLimit,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1}else if(i.is('[name$="'+e+'"]')){var s=parseFloat(i.closest("tr").find('[name$="'+a+'"]').val());if(""==s)return!1;if(l<s)return i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.lessThanLowerLimit,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;if(l==s)return i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.equalToLowerLimit,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1}o.each(function(l,o){function r(){var t=parseFloat($(o).find('[name$="'+a+'"]').val()),n=parseFloat($(o).find('[name$="'+e+'"]').val()),l=$(o).index()+1,r=(-1!=i.attr("name").indexOf(a)?a:e)==a?e:a,s=parseFloat(i.val()),d=parseFloat(i.closest("tr").find('[name$="'+r+'"]').val());return d<=t&&s>=t&&""!=d||d<=n&&s>=n&&""!=d?(i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.theNumberEntered+l+top.languageInit.allLanguage.intersectionBetween,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):s==t?(i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.theNumberEntered+l+top.languageInit.allLanguage.equalToLowerNumber,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):s==n?(i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.theNumberEntered+l+top.languageInit.allLanguage.equalToUpperNumber,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):s>t&&s<n?(i.val(""),i.attr("value",""),top.layer.alert(top.languageInit.allLanguage.theNumberEntered+l+top.languageInit.allLanguage.rangeBetween,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1):void 0}void 0!=t?$(o).find('[name$="'+t+'"]').val()==n&&r():r()})})}function calendarInit(a){$(".addrow, .copyrow, .delrow").hide();var e=$(".custabcons").eq(2);0==e.length&&(e=$(".custabcons[tab='detailInfo']")),e.find(".layui-input-inline :checkbox+:checkbox").css({"margin-left":"10px"}),e.find(".layui-input-inline :checkbox+:checkbox").closest(".layui-input-inline").css({"margin-top":"0px"}),e.find(".addcopydel").css({"max-height":"200px",overflow:"auto"});var t='<button class="layui-btn layui-btn-normal calendarInit" type="button">'+top.languageInit.allLanguage.generateDetailInfo+"</button>";(console.log(top.languageInit.allLanguage.detailInfo),e.find(".addcopydel").before(t),$(".addBody").length)&&e.find('input[type="checkbox"]').attr("disabled",!1);-1!=top.$("#admin-body iframe:visible").attr("src").indexOf("audit")&&($(".calendarInit:visible").addClass("layui-btn-disabled"),$(".calendarInit:visible").attr("disabled","disabled")),e.find(".addcopydel table :checkbox").closest("th").hide(),e.find(".addcopydel table :checkbox").closest("td").hide(),calendarInitClick(a,e)}function calendarInitClick(a,e){$(".calendarInit").length>0&&$(".calendarInit").click(function(){var t=$("[name$='.effectiveDate']:visible").val(),n=$("[name$='.expiryDate']:visible").val();if(""!=t&&""!=n){var i="";if($("[name$='.workingDay']:visible").each(function(a,e){$(e).is(":checked")&&(i=""==i?$(e).val():i+"_"+$(e).val())}),""!=i){var l={effectiveDate:t,expiryDate:n,workingDay:i};$.ajax({type:"post",url:a,contentType:"application/text; charset=utf-8",async:!1,data:JSON.stringify(l),success:function(a){"string"==typeof a&&(a=JSON.parse(a));var t=e.find("table tbody tr");t.not(":first-child").remove(),t.eq(0).find("input").val("");a.length;$.each(a,function(a,n){a>0&&(e.find(".addrow").click(),t=e.find("table tbody tr"));var i=Object.keys(n);$.each(i,function(e,i){t.eq(a).find('[name$="'+i+'"]').val(n[i])})})}})}else top.layer.msg(top.languageInit.allLanguage.selectWeekdayInfo)}else top.layer.msg(top.languageInit.allLanguage.selectDate)})}function srcurl(){var a=parent.$("iframe:visible").attr("src").split(".html")[0];return a.substring(0,a.lastIndexOf("/")+1)}function iframeReadonly(){$("input:not(':checkbox')").attr("readonly","readonly"),$("input:not(':checkbox')").attr("disabled","disabled"),$("select").attr("disabled","disabled"),$(".back").addClass("divDisabled"),$(".datepicker, .ui-datepicker-trigger").addClass("divDisabled"),$("button:not('.auditform','.copyform','.allopebtn')").attr("disabled","disabled")}function BomRevBackQuantity(a){var e=a.val(),t=a.attr("name").split("]")[0].split("[")[1];top.$("#admin-body iframe:visible").contents().find('.custabcons[tab="'+top.languageInit.allLanguage.productionMaterialUse+'"] .addcopydel[name="['+t+']"]').find("table tbody tr").each(function(a,t){var n=$(t).find(".requiredQuantity"),i=$(t).find(".notPickingQuantity"),l=""!=$(t).find(".numerator").val()?$(t).find(".numerator").val():0,o=""!=$(t).find(".denominator").val()?$(t).find(".denominator").val():1,r=""!=$(t).find(".fixedLoss").val()?$(t).find(".fixedLoss").val():0,s=""!=$(t).find(".variableLossRate").val()?$(t).find(".variableLossRate").val():0,d=unitPrecision(""!=$(t).find('[name$="dUnit"]').val()?$(t).find('[name$="dUnit"]').val():0),u=(l/o*e+parseFloat(r))*(1+parseFloat(s/100));n.val(u.toFixed(d)),n.attr("value",u.toFixed(d)),i.attr("value",u.toFixed(d))})}function quantity(){$(".productionQuantity").keyup(function(){BomRevBackQuantity($(this))}),$(document).on("keyup",".numerator, .denominator, .fixedLoss, .variableLossRate",function(){$(this).val();var a=$(this).closest(".addcopydel").attr("name").split("]")[0].split("[")[1],e=$('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] .addcopydel table tbody tr').eq(a).find(".productionQuantity").val(),t=$(this).closest("tr"),n=t.find(".requiredQuantity"),i=""!=t.find(".numerator").val()?t.find(".numerator").val():0,l=""!=t.find(".denominator").val()?t.find(".denominator").val():1,o=""!=t.find(".fixedLoss").val()?t.find(".fixedLoss").val():0,r=""!=t.find(".variableLossRate").val()?t.find(".variableLossRate").val():0;if(void 0==(s=""!=t.find('[name$=".unit"]').val()?t.find('[name$=".unit"]').val():0))var s=""!=t.find('[name$=".dUnit"]').val()?t.find('[name$=".dUnit"]').val():0;var d=(i/l*e+parseFloat(o))*(1+parseFloat(r/100)),u=unitPrecision(s);n.val(d.toFixed(u));var c=void 0!=t.find('[name$="dPickedQuantity"]').val()?t.find('[name$="dPickedQuantity"]').val():t.find('[name$="pickingCount"]').val();""!=c&&(0!=t.find('[name$="dUnPickedQuantity"]').length?t.find('[name$="dUnPickedQuantity"]'):t.find('[name$="notPickingCount"]')).val(d.toFixed(u)-c)})}function backClick(){$(document).on("click",".back",function(){-1!=top.$("#admin-body iframe:visible").attr("src").indexOf("MonitorSolution")&&("device"==$('[name$="monitorSystem"]').val()?$("#monitorObjectName").attr("backkey","monitorDev").attr("serverName","baseData"):$("#monitorObjectName").attr("backkey","monitorObject").attr("serverName","backend"));var a=$(this),e="";if(a.hasClass("fa-search"))if(a.parent(".layui-input-inline").length)e=(a=a.parent(".layui-input-inline").find("input")).parent(".layui-input-inline").siblings(".layui-form-label").text().replace(":","");else{var t=(a=a.parent("td").find("input")).parent("td").index();e=a.parents(".addedit").find("tr:eq(0)").find("th:eq("+t+")").text()}if(a.parent(".layui-input-inline").length)a.closest(".custabcons.select").find(".layui-input");else a.closest("tr");if(a.is("input"))var n="back.html",i=e;else if(a.is("button"))n="select.html",i=top.languageInit.allLanguage.chooseOrder;var l=a.attr("servername"),o="";if(void 0!=a.attr("name")){var r=isBackNeedParam(a);if(!1===r)return!1;o=r}else{$(".selectParm").length>0&&$(".selectParm li").each(function(a,e){var t=$(e).text(),n=$("[name$="+t+"]").val();o=0==a?o+"?"+t+"="+n:o+"&"+t+"="+n})}var s=a.attr("backkey");if(-1==(d=parent.$("iframe:visible").attr("src").split(".html")[0]).indexOf("/"))var d=parent.parent.$("iframe:visible").attr("src");var u=d.substring(0,d.lastIndexOf("/")+1);if(a.closest("td").length>0&&0==a.closest(".jsplumbjsplumb").length&&0==a.closest(".data").length){a.closest("td").find("input").attr("name");if(a.closest("td").find("i").hasClass("backPivotal"))var c="tablebackPivotal_"+a.closest("tr").index();else c="tableback_"+a.closest("tr").index()}else c="divback"+(new Date).getTime();var f="";if(void 0!=s){var g=$(window.parent.document).find("iframe:visible").attr("src"),m=!0;u=u.indexOf("common")>0?g.match(/src.+/)[0].match(/pages.+/)[0]:u,localStorage.setItem("srcs",u),$.each(backSpecial,function(a,e){if(g.indexOf(e)>0)return m=!1,!1}),f=""==o?m?"pages/general/common/"+n+"?"+s:u+n+"?"+s:m?"pages/general/common/"+n+"?backKey="+s+o:u+n+"?backKey="+s+o}else void 0==s&&(f=""==o?u+n:u+n+o);localStorage.setItem("serverName",l),top.layer.open({id:c,type:2,title:i||findBack,area:["800px","540px"],maxmin:!0,content:f,restore:function(a){var e=a.find("iframe").contents();e.find("#gbox_backlist").removeClass("width97");var t=e.find("#backlist"),n=e.find("#backpager");$(n).removeClass("width100"),$(t).setGridWidth(764,!1)},full:function(a){var e=a.find("iframe").contents(),t=e.find("#gbox_backlist");t.addClass("width97");var n=e.find("#backlist"),i=e.find("#backpager"),l=t.css("width").replace("px","");$(i).addClass("width100"),$(n).setGridWidth(l,!1)},min:function(a){console.log("---------ddddddddd---------")},btn:[top.languageInit.allLanguage.sure],yes:function(e,t){if(t.find("iframe").contents().find(".backinfo").click(),"monitorObjectName"==a.attr("name")){$("#searchmodfbox_list").remove(),$(".monitoringCondition").append('<table id="list"></table>');var n=top.$("#admin-body iframe:visible").contents().find("[name='monitorObject']").val(),i=top.$("#admin-body iframe:visible").contents().find("[name='monitorSystem']").val();if(!n)return top.layer.alert(top.languageInit.allLanguage.monitorCantBeEmpty,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;switch(n){case"maintain_order":n="MesDeviceServices",top.$("#admin-body iframe:visible").contents().find("[name='monitorObject']").val(n);break;case"repair_order":n="MesDeviceRepairs",top.$("#admin-body iframe:visible").contents().find("[name='monitorObject']").val(n);default:n=n,top.$("#admin-body iframe:visible").contents().find("[name='monitorObject']").val(n)}var l=testDomainName+"/api-b/dataCenterMonitorSetting/getPropertyByTable/"+n+"/"+i;pageInit(l),$("#gbox_list").remove(),$("#alertmod_list").remove(),$("#searchmodfbox_list").css("position","static"),$(".EditTable").remove()}top.layer.close(e)},btn2:function(a,e){top.layer.close(a)}})})}function backinfoClick(a,e,t){var n=$("#backlist");if(parent.$("[id^=tablebackPivotal]").length>0)var i=n.jqGrid("getGridParam","selarrrow");else i=n.jqGrid("getGridParam","selrow");if(void 0!=a){for(var l=[],o=[],r=0;r<a.length;r++)l.push(a[r].backInfo),o.push(a[r].input);if(parent.$("[id^=tablebackPivotal]").length>0){var s=parseInt(parent.$("[id^=tableback]").attr("id").split("_")[1]),d=top.$("#admin-body iframe:visible").contents().find("tbody"),u=[];$.each(i,function(a,e){var t={};$.each(l,function(a,i){var l=n.jqGrid("getRowData",e)[""+i];t[o[a]]=l}),u.push(t)});var c=o[0].split(".")[1],f=d.find("[name$="+c+"]").closest(".custabcons"),g=f.find("table tbody"),m=[];m.push(s);var p=1;if(g.find("tr").each(function(a,e){""==$(e).find("[name$="+c+"]").val()&&a!=s&&p++}),p<=u.length){var v=Number(u.length)-p;for(r=0;r<=v;r++)f.find(".addrow").click()}g.find("tr").each(function(a,e){a>s&&m.length<u.length&&""==$(e).find("[name$="+c+"]").val()&&m.push(a)})}else{var b={};$.each(l,function(a,e){var t=n.jqGrid("getRowData",i)[""+e];b[o[a]]=t}),console.log(b)}$.each(o,function(a,e){var t=e.split(".")[0],n=e.split(".")[1];if(parent.$(".layui-layer-iframe:last").find("[id^=tablebackPivotal]").length>0){var i=parseInt(parent.$("[id^=tableback]").attr("id").split("_")[1]),l=top.$("#admin-body iframe:visible").contents().find("tbody"),r=0;$.each(m,function(a,i){var o=t+"["+i+"]."+n;batchNumberAble(e,u,r,l,i),Inspection2(e,u,r,l,i),l.find("[name$='"+o+"']").val(u[r][e]);var s=l.find("[name$='"+o+"']"),d=u[r][e];selectTextVal(s,d),r++,l.find("[name$='"+o+"']").focus()})}else if(parent.$(".layui-layer-iframe:last").find("[id^=tableback]").length>0&&0==parent.$(".layui-layer-iframe:last").find("[id^=tablebackPivotal]").length){i=parseInt(parent.$("[id^=tableback]").attr("id").split("_")[1]),l=top.$("#admin-body iframe:visible").contents().find("tbody");var s=t+"["+i+"]."+n;l.find("[name$='"+s+"']").val(b[e]);var d=l.find("[name$='"+s+"']"),c=b[e];selectTextVal(d,c),formatLength(e,i,b),sameUnit(e,i,b),l.find("[name$='"+s+"']").focus()}else if(parent.$(".layui-layer-iframe:last").find("[id^=divback]").length>0||parent.$(".layui-layer-iframe:first").find("[id^=jsPlumb]").length>0){if(-1==top.$("#admin-body iframe:visible").attr("src").indexOf("/treeSearch.html")&&-1==top.$("#admin-body iframe:visible").attr("src").indexOf("/treesearch.html")||1!=parent.$(".layui-layer-iframe").length){if(top.$("#admin-body iframe:visible").contents().find("[name$='"+e+"']").length>0&&1==parent.$(".layui-layer-iframe").length||parent.$(".layui-layer-iframe").eq(parent.$(".layui-layer-iframe").length-2).find("iframe").contents().find("[name='"+e+"']").length>0&&parent.$(".layui-layer-iframe").length>1){d=top.$("#admin-body iframe:visible").contents().find("[name$='"+e+"']").length>0?top.$("#admin-body iframe:visible").contents().find("[name$='"+e+"']"):parent.$(".layui-layer-iframe").eq(parent.$(".layui-layer-iframe").length-2).find("iframe").contents().find("[name='"+e+"']"),c=b[e];d.val(b[e]).change(),selectTextVal(d,c),clearAddress(e,b),d.focus(),d.blur(),d.change(),console.log(b[e])}else if(0==parent.$(".layui-layer-iframe:last").find("[id^=tableback]").length&&0==parent.$(".layui-layer-iframe:last").find("[id^=divback]").length){var f="";2==e.split(".").length?f=e.split(".")[1]:(e.split(".").length=en=3)&&(f=e.split(".")[2]);var g=top.$(".layui-layer").eq(0).find("iframe").contents(),p=g.find("form:visible");if("poName"==f){var v=p.attr("id");g.find("#drawingContentNodes"+v).find("span").eq(0).text(b[e])}p.find("input[name$='"+f+"']").val(b[e]);d=p.find("select[name$='"+f+"']"),c=b[e];selectTextVal(d,c)}}else{var d=top.$("#admin-body iframe:visible").contents().find("iframe").contents().find("[name='"+e+"']"),c=b[e];selectTextVal(d,c),top.$("#admin-body iframe:visible").contents().find("iframe").contents().find("[name='"+e+"']:not('select')").val(b[e])}scaleTable(a,e,b,o)}})}if(void 0!=e){var h=e,y={};if($.each(h,function(a,e){if(-1!=e.indexOf(".")){var t=n.jqGrid("getRowData",i)[""+e];y[e]=t}else{t=top.$("#admin-body iframe:visible").contents().find('[name$="'+e+'"]').val();y[e]=t}}),void 0==a)(I=[]).push(y);else var I=y;$.ajax({type:"post",url:t,contentType:"application/text; charset=utf-8",async:!1,data:JSON.stringify(I),success:function(a){if(console.log(a),"string"==typeof a&&(a=JSON.parse(a)),scaleJson(a,o),void 0!=parent.$("[id^=tableback]").attr("id")){var e=parseInt(parent.$("[id^=tableback]").attr("id").split("_")[1]),t=top.$("#admin-body iframe:visible").contents(),n=t.find('.custabcons[tab="'+top.languageInit.allLanguage.productionMaterialUse+'"]').length>t.find('.custabcons[tab="'+top.languageInit.allLanguage.checkInfo+'"]').length?t.find('.custabcons[tab="'+top.languageInit.allLanguage.productionMaterialUse+'"] .addcopydel[name="['+e+']"]'):t.find('.custabcons[tab="'+top.languageInit.allLanguage.checkInfo+'"] .addcopydel[name="['+e+']"]');n.find("table tbody tr:not(:first-child)").remove(),n.find("table tbody tr:first-child input:not([name$='lineNo'])").val("");for(var i=1;i<a.length;i++)n.find(".addrow").click();$.each(a,function(a,e){var t=Object.keys(e);$.each(t,function(t,i){var l=i.split(".")[0],o=i.split(".")[1],r=l+"["+a+"]."+o;n.find('[name$="'+r+'"]').val(e[i]),n.find('[name$="'+r+'"]').attr("value",e[i])})})}else editspe("",a)},error:function(){}})}"function"==typeof fn&&fn(top.$("#admin-body iframe:visible").contents());var L=top.$(".layui-layer-content").find("iframe").attr("src");if(-1!=L.indexOf("back.html")){if(-1!=L.indexOf("backKey"))var k=L.split("backKey=")[1].split("&")[0];else k=L.split("back.html?")[1];if("bom"==k){s=top.$(".layui-layer-content").attr("id").split("tableback_")[1];var x=a[0].input.split(".")[0]+"["+s+"]."+a[0].input.split(".")[1];BomRevBackQuantity(top.$("#admin-body iframe:visible").contents().find('[name="'+x+'"]').closest("tr").find('[name$="productionQuantity"]'))}else if("inspectionPlan"==k){s=top.$(".layui-layer-content").attr("id").split("tableback_")[1];samplingScheme(top.$("#admin-body iframe:visible").contents().find('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] table tbody tr').eq(s).find('[name$="checkNum"]'),"back")}}}function clearAddress(a,e){a.endsWith(".country")&&top.$("#admin-body iframe:visible").contents().find('[name$="area"], [name$="areaId"], [name$="provinceId"], [name$="province"], [name$="cityId"], [name$="city"]').val(""),a.endsWith(".area")&&top.$("#admin-body iframe:visible").contents().find('[name$="provinceId"], [name$="province"], [name$="cityId"], [name$="city"]').val(""),a.endsWith(".province")&&top.$("#admin-body iframe:visible").contents().find('[name$="cityId"], [name$="city"]').val("")}function batchNumberAble(a,e,t,n,i){-1!=a.indexOf(".isBatch")&&(e[t][a]==top.languageInit.allLanguage.yes&&""==e[t]["ProductionOtherInOrderDetail.batchRuleId"]&&-1!=a.indexOf("ProductionOtherInOrderDetail")?(n.find('[name$="['+i+'].batchNumber"]').attr("readonly",!1),n.find('[name$="['+i+'].batchNumber"]').next().removeClass("divDisabled"),n.find('[name$="['+i+'].batchNumber"]').closest("td").addClass("edit-inline")):e[t][a]==top.languageInit.allLanguage.yes&&-1==a.indexOf("ProductionOtherInOrderDetail")?(n.find('[name$="['+i+'].batchNumber"]').attr("readonly",!1),n.find('[name$="['+i+'].batchNumber"]').next().removeClass("divDisabled"),n.find('[name$="['+i+'].batchNumber"]').closest("td").addClass("edit-inline")):(n.find('[name$="['+i+'].batchNumber"]').attr("readonly",!0),n.find('[name$="['+i+'].batchNumber"]').next().addClass("divDisabled"),n.find('[name$="['+i+'].batchNumber"]').closest("td").removeClass("edit-inline")))}function scaleJson(a,e){if(Array.isArray(a)&&-1!=JSON.stringify(a[0]).indexOf("transformType")&&-1!=JSON.stringify(a[0]).indexOf("baseUnitNum")&&-1!=JSON.stringify(a[0]).indexOf("baseUnit")&&-1!=JSON.stringify(a[0]).indexOf("transformUnit")&&-1!=JSON.stringify(a[0]).indexOf("transformUnitNum")){var t=e[0],n=parseInt(parent.$("[id^=tableback]").attr("id").split("_")[1]),i=t.split(".")[0]+"["+n+"]."+t.split(".")[1];top.$(".layui-tab-content iframe:visible").contents().find('[name="'+i+'"]').closest("tr").find('[name$="scale"]').val(JSON.stringify(a))}}function unitTable(){if(-1!=window.frameElement.src.indexOf("material")&&(-1!=window.frameElement.src.indexOf("view")||-1!=window.frameElement.src.indexOf("copy")||-1!=window.frameElement.src.indexOf("edit")||-1!=window.frameElement.src.indexOf("audit"))){var a=0;$(".addcopydel table tbody tr").each(function(e,t){""==$(t).find('[name$="baseUnitNum"]').val()&&""==$(t).find('[name$="transformUnitNum"]').val()||a++}),0!=a?$(".addcopydel").show():$(".addcopydel").hide()}}function scaleTable(a,e,t,n){if("BaseUnitTransform.baseUnit"==e&&top.$("#admin-body iframe").contents().find("input[name^='BaseUnitTransform']").filter("input[name$='baseUnit']").val(t[e]),a==n.length-1&&(-1!=n[0].indexOf("BMaterial.baseUnitName")||-1!=n[0].indexOf("BMaterial.stockUnitName")||-1!=n[0].indexOf("BMaterial.stockUnitSecName")||-1!=n[0].indexOf("BMaterial.procutUnit"))){var i=top.$("#admin-body iframe:visible").contents().find('[name="BMaterial.baseUnitName"]').val(),l=top.$("#admin-body iframe:visible").contents().find('[name="BMaterial.stockUnitName"]').val(),o=top.$("#admin-body iframe:visible").contents().find('[name="BMaterial.stockUnitSecName"]').val(),r=top.$("#admin-body iframe:visible").contents().find('[name="BMaterial.procutUnit"]').val(),s=[];""==o?s.push(i,l,r):s.push(i,l,o,r);var d=0;$.each(s,function(a,e){$.each(s,function(a,t){e!=t&&d++})}),d>0?top.$("#admin-body iframe:visible").contents().find(".addcopydel").show():top.$("#admin-body iframe:visible").contents().find(".addcopydel").hide()}}function sameUnit(a,e,t){if(-1!=a.indexOf("BaseUnitTransform")&&-1!=a.indexOf("transformUnit")){var n=top.$("#admin-body iframe:visible").contents().find("[name$='["+e+"].baseUnit']").filter('[name^="BaseUnitTransform"]').val(),i=top.$("#admin-body iframe:visible").contents().find("[name$='["+e+"].baseUnitNum']").filter('[name^="BaseUnitTransform"]'),l=top.$("#admin-body iframe:visible").contents().find("[name$='["+e+"].transformUnitNum']").filter('[name^="BaseUnitTransform"]');n==t[a]?(i.attr("readonly",!0),i.val(1),l.attr("readonly",!0),l.val(1)):(i.attr("readonly",!1),l.attr("readonly",!1))}}function formatLength(a,e,t){-1==a.indexOf("CodeRuleDetail")&&-1==a.indexOf("OtherCodeRuleDetail")||-1==a.indexOf("format")||top.$("#admin-body iframe:visible").contents().find("[name$='["+e+"].length']").val(t[a].length)}function setSize(){$(".ui-jqgrid-htable").css("width","auto"),$(".ui-jqgrid-htable th").css("width",""),$(".ui-jqgrid-btable").css("width",""),$(".ui-jqgrid-btable td").css("width","");var a=$(".ui-jqgrid-htable th").length,e=[];for(i=0;i<a;i++){var t,n=$(".ui-jqgrid-htable th").eq(i).width()+31,l=($(".ui-jqgrid-btable tr").length,n>(t=(t=0)>$(".ui-jqgrid-btable tr").eq(0).find("td").eq(i).width()?t:$(".ui-jqgrid-btable tr").eq(0).find("td").eq(i).width())?n:t);e.push(l)}var o=0;$.each(e,function(a,e){$(".ui-jqgrid-htable th").eq(a).width(e),$(".ui-jqgrid-btable tr:first-child td").eq(a).width(e),$(".ui-jqgrid-htable th").eq(a).is(":visible")&&(o+=e)}),$(".ui-jqgrid-htable, .ui-jqgrid-btable").width(o),$("#backlist").setGridWidth($("#gbox_list").width(),!1)}function zkbg(){$(".zkbg").click(function(){setSize()})}function cusTab(){$(document).on("click",".custabtits",function(){var a=$(this).attr("tab");$(this).addClass("select").siblings().removeClass("select"),$(".custabcons[tab='"+a+"']").addClass("select").siblings().removeClass("select"),$(".custabcons[tab='"+a+"']").show().siblings().hide()})}function aedbtnsspe(){var a=pageObjDet(),e=a[0],t=a[1];$.each(e,function(a,t){$(document).on("click",'.custabcons[tab="'+e[0]+'"] .aedbtns',function(){var a=$(this).attr("namename").split("[")[1].split("]")[0],e=$('.custabcons[tab="'+t+'"]');if(!$(this).is(":checked"))return top.layer.alert(top.languageInit.allLanguage.mustChooseOne,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;$(this).closest("tr").siblings().find(".aedbtns").removeAttr("checked"),e.find(".layui-form-item").hide(),e.find('.layui-form-item[name="['+a+']"]').show()})}),$.each(t,function(a,t){$(document).on("click",'.custabcons[tab="'+e[0]+'"] .aedbtns',function(){"0"==(n=$(this).closest("tr").find("[name$=isSn]").val())?$(".custabtits[tab='"+top.languageInit.allLanguage.sn+"']").addClass("none"):$(".custabtits[tab='"+top.languageInit.allLanguage.sn+"']").removeClass("none");var a=$(this).attr("namename").split("[")[1].split("]")[0],e=$('.custabcons[tab="'+t+'"]');if(!$(this).is(":checked"))return top.layer.alert(top.languageInit.allLanguage.mustChooseOne,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;if($(this).closest("tr").siblings().find(".aedbtns").removeAttr("checked"),e.find(".addcopydel").hide(),e.find('.addcopydel[name="['+a+']"]').show(),"true"==n){var n=$(this).closest("tr").find('[name$="isSn"]').val();$('.custabtits[tab="'+top.languageInit.allLanguage.sn+'"]').addClass("divDisabled")}})})}function obj2detail3(a,e,t){if(0!=a.closest('.custabcons[tab="工序列表"]').length||0!=a.closest('.custabcons[tab="明细信息"]').length){var n=pageObjDet();if(0==n)return!1;var i=n[0],l=n[1],o=a.closest(".addcopydel").find("table tbody tr").index();$.each(i,function(a,n){if(0!=a){var i=$('.custabcons[tab="'+n+'"]'),l=i.find('.layui-form-item[name="['+t+']"]').html().replace(/\[(\d+)\]/g,"["+o+"]");i.append('<div class="layui-form-item" style="display: none;" name="['+o+']">'+l+"</div>");var r=$('.custabcons[tab="'+n+'"] .layui-form-item:last');"addrow"==e?(r.find("input").val(""),r.find("tr:gt(0)").remove()):"copyrow"==e&&r.find('[name$=".id"]').val("")}}),$.each(l,function(a,t){var n=$('.custabcons[tab="'+t+'"]'),i=n.find(".addcopydel").html().replace(/ name=(\D+)(\d+)/g," name=$1"+o);n.append('<div class="addcopydel" style="display: none;" name="['+o+']">'+i+"</div>");var l=$('.custabcons[tab="'+t+'"] .addcopydel:last');"addrow"==e?(l.find("input").val(""),l.find("tr:gt(1)").remove()):"copyrow"==e&&l.find('[name$=".id"]').val("")})}}function comparisonQantity(a,e){$(document).on("change",'[name$="'+a+'"]',function(){if(Number($(this).val())>Number($(this).closest("tr").find('[name$="'+e+'"]').val()))return top.layer.alert(top.languageInit.allLanguage.cannotGreaterThanApplyNum,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),$(this).val(0).keyup(),!1})}function SNAdd(a,e){$(document).on("keyup","#SNno",function(){if("13"==event.keyCode){if(void 0!=e){var t=$('[name$="billType"]').val();e[2]=0==t?"0":1==t||2==t?"-1":"1";e[0],e[1];var n=e[2]}var i=$(this),l=$(this).val(),o=$(this).attr("snType"),r=null,s=$(this).closest(".addcopydel").attr("name"),d=$('[name$="'+s+'.batchNumber"]').val();console.log("batchNumber:"+d);var u=$('[name$="PlantProductionExecution.flowNo"]').val();r=""==d?{type:o,snNo:l,qualityStatus:n,flowNo:u}:{type:o,snNo:l,qualityStatus:n,batchNumber:d,flowNo:u};var c=!0;i.closest(".custabcons").find("table tbody tr").each(function(){if($(this).find('input[name$="snNo"]').val()==l){var a=$(this).closest(".addcopydel").index(),e=top.languageInit.allLanguage.snAndDetail+(a+1)+top.languageInit.allLanguage.snRepeat;layer.msg(e,{icon:7,time:3e3}),c=!1}}),c&&$.ajax({url:a,type:"post",contentType:"application/text; charset=utf-8",async:!1,data:JSON.stringify(r),success:function(a){"string"==typeof a&&(a=JSON.parse(a)),"200"==a.header.status?(""!=i.closest(".addcopydel").find("table tbody tr:last-child").find('[name$="snNo"]').val()&&i.closest(".addcopydel").find(".addrow").click(),i.closest(".addcopydel").find("table tbody tr:last-child").find('[name$="snNo"]').val(l),i.closest(".addcopydel").find("table tbody tr:last-child").find('[name$="snNo"]').attr("value",l)):alert(a.header.statusContent)}})}})}function SNUnqualified(){$(document).on("keyup","#SNUnqualified",function(){if("13"==event.keyCode){var a=$(this),e=$(this).val(),t=0;if(a.closest(".addcopydel").find("table tbody tr").each(function(n,i){if($(this).find('input[name$="snNo"]').val()==e){$(this).find('select[name$="selfCheckResult"]').val(1),$(".divOverflow").scrollTop(0);var l=$(this).offset().top,o=$(".divOverflow").offset().top;return $(".divOverflow").scrollTop(l-o),QualifiedNum(a),!1}t++}),t==a.closest(".addcopydel").find("table tbody tr").length)return top.layer.alert(top.languageInit.allLanguage.snNotExist,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1}})}function QualifiedNum(a){var e=0,t=0;$(a).closest(".addcopydel").find("table tbody tr").each(function(a,n){var i=$(n).find('[name$=".selfCheckResult"]').val();0==i?e++:1==i&&t++}),$(a).closest("body").find('[name$=".qualifiedNum"]').val(e),$(a).closest("body").find('[name$=".unqualifiedNum"]').val(t)}function onlyTr(){$(document).on("click",".aedbtns",function(){if(!$(this).is(":checked"))return top.layer.alert(top.languageInit.allLanguage.mustChooseOne,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;$(this).closest("tr").siblings().find(".aedbtns").removeAttr("checked")})}function formatDate(a){var e=a.getFullYear(),t=a.getMonth()+1;t=t<10?"0"+t:t;var n=a.getDate();return e+"-"+t+"-"+(n=n<10?"0"+n:n)}function nameStartEndArr(){return{nameStartArr:["dEffectiveDate","effectiveDate"],nameEndArr:["dExpiryDate","expiryDate"]}}function datepickerDefaultValueObj(a){var e=nameStartEndArr(),t=e.nameStartArr,n=e.nameEndArr;$.each(t,function(e,t){a.find("[name$="+t+"]").val(formatDate(new Date))}),$.each(n,function(e,t){a.find("[name$="+t+"]").val("2099-12-31")})}function datepickerDefaultValueName(a){var e="",t=nameStartEndArr(),n=t.nameStartArr,i=t.nameEndArr;return $.each(n,function(t,n){-1!=a.indexOf(n)&&(e=formatDate(new Date))}),$.each(i,function(t,n){-1!=a.indexOf(n)&&(e="2099-12-31")}),e}function addCopyRow(){$(document).on("click",".addrow, .copyrow",function(){var a="";$(this).hasClass("addrow")?a="addrow":$(this).hasClass("copyrow")&&(a="copyrow");var e=$(this).closest(".addcopydel").find("table tbody");if("copyrow"==a&&e.find(".aedbtns:checked").length<1)return top.layer.alert(top.languageInit.allLanguage.chooseContentCopy,{title:top.languageInit.allLanguage.addNode,btn:[top.languageInit.allLanguage.setSure]}),!1;var t=0;"copyrow"==a&&(t=e.find(".aedbtns:checked").closest("tr").index()),e.append(e.find("tr").eq(t).clone());var n=e.find("tr:first"),i=e.find("tr:last"),l=e.find("tr:last").index();if("addrow"==a){i.find("input").val("");var o=n.find('[name^="BaseUnitTransform"]').filter('[name$="baseUnit"]'),r=i.find('[name^="BaseUnitTransform"]').filter('[name$="baseUnit"]');if(o.length>0){var s=o.val();r.val(s)}i.find('[name$="startDate"]').filter('[name^="EngineeringWorkHours"]').val("00:00"),i.find('[name$="endDate"]').filter('[name^="EngineeringWorkHours"]').val("23:59")}else"copyrow"==a&&(i.find('[name$=".id"]').val(""),i.find('[name$=".spBatchDown"]').val(""),i.find('[name$=".spBatchUp"]').val(""),i.find('[name$=".rangeDown"]').val(""),i.find('[name$=".rangeUp"]').val(""));(i.find(":checkbox").removeAttr("checked"),i.find('[name$=".lineNo"]').val(l+1),i.find('[name$=".dMaterialNo"]').removeAttr("disabled").removeClass("removeDisabled"),i.find('[name$=".dChildBomRev"]').removeAttr("disabled").removeClass("removeDisabled"),i.find('[name$=".dMaterialNo"]').next().removeClass("divDisabled"),i.find('[name$=".dChildBomRev"]').next().removeClass("divDisabled"),i.find(".datepicker").removeAttr("id"),i.find(".datetimepicker").removeAttr("id"),i.find(".timepicker").removeAttr("id"),i.find(".hasDatepicker").removeClass("hasDatepicker"),i.find(".ui-datepicker-trigger").remove(),cusdatetimepicker(i),"addrow"==a)&&datepickerDefaultValueObj(i);e.find("tr:last td").each(function(a,e){var t=$(e).find("input").attr("name")||$(e).find("select").attr("name")||$(e).find("input").attr("namename");if(-1!=configDetail3.indexOf($(this).closest(".custabcons").attr("tab")))if($(e).find(".aedbtns").length>0)var n=t.replace(/\[(\d+)\]/g,"["+l+"]");else n=t.replace(/(\D+)(\d+)(\D+)(\d+)/g,"$1$2$3"+l);else n=t.replace(/\[(\d+)\]/g,"["+l+"]");$(e).find(".aedbtns").length>0?$(e).find("input").attr("namename",n):($(e).find("input").attr("name",n),$(e).find("select").attr("name",n))}),obj2detail3($(this),a,t)})}function delrow(){$(document).on("click",".delrow",function(){var a=$(this).closest("form"),e=$(this).closest(".addcopydel"),t=e.find("table tbody");if(0==t.find(".aedbtns:checked").length)top.layer.alert(top.languageInit.allLanguage.selectAtLeastOneToDelete,{title:top.languageInit.allLanguage.addNode,btn:[top.languageInit.allLanguage.setSure]});else{var n=t.find(".aedbtns:checked").closest("tr").index();if(1==t.find("tr").length){var i;if(t.find("tr input:not([name$=lineNo])").val(""),t.find("tr :checkbox").removeAttr("checked"),e.closest(".custabcons[tab='"+top.languageInit.allLanguage.detailInfo+"']").length>0||e.closest(".custabcons[tab='工序列表']").length>0)if(0!=(i=pageObjDet())){var l=i[0],o=i[1];$.each(l,function(a,e){0!=a&&($('.custabcons[tab="'+e+'"]').find(".layui-form-item[name='["+n+"]'] input").val(""),$('.custabcons[tab="'+e+'"]').find(".layui-form-item[name='["+n+"]'] input").attr("value",""))}),$.each(o,function(a,e){$('.custabcons[tab="'+e+'"]').find(".addcopydel[name='["+n+"]'] input").val(""),$('.custabcons[tab="'+e+'"]').find(".addcopydel[name='["+n+"]'] input").attr("value","")})}return!1}if(t.find(".aedbtns:checked").length>1)return top.layer.alert(top.languageInit.allLanguage.onlyOneCanBeSelectedForDeletion,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;if(t.find(".aedbtns:checked").closest("tr").find('[name$="workingHours"]').filter('[name^="EngineeringWorkHours"]').length>0){var r=t.find(".aedbtns:checked").closest("tr").find('[name$="workingHours"]').filter('[name^="EngineeringWorkHours"]').val(),s=a.find('.layui-form-item [name$="workingHours"]').filter('[name^="EngineeringWorkNumbers"]'),d=s.val();s.val(d-r)}if(t.find(".aedbtns:checked").closest("tr").remove(),e.closest(".custabcons[tab='"+top.languageInit.allLanguage.detailInfo+"']").length>0||e.closest(".custabcons[tab='工序列表']").length>0)if(0!=(i=pageObjDet())){l=i[0],o=i[1];$.each(l,function(a,e){0!=a&&($('.custabcons[tab="'+e+'"]').find(".layui-form-item[name='["+n+"]']").remove(),$('.custabcons[tab="'+e+'"]').find(".layui-form-item[name='[0]']").show(),$('.custabcons[tab="'+e+'"]').find(".layui-form-item").each(function(a,e){var t=$(e).index();$(e).attr("name","["+t+"]");var n=$(e).html().replace(/ name=(\D+)(\d+)/g," name=$1"+t);$(e).empty(),$(e).append(n)}))}),$.each(o,function(a,e){$('.custabcons[tab="'+e+'"]').find(".addcopydel[name='["+n+"]']").remove(),$('.custabcons[tab="'+e+'"]').find(".addcopydel[name='[0]']").show(),$('.custabcons[tab="'+e+'"]').find(".addcopydel").each(function(a,e){$(e).attr("name","["+$(e).index()+"]")}),$('.custabcons[tab="'+e+'"]').find("table tbody tr td input").each(function(a,e){var t=$(e).closest(".addcopydel").index();if(void 0!=$(e).attr("name"))n=(n=$(e).attr("name")).replace(/(\d+)(\D+)(\d+)/g,t+"$2$3");else if(void 0!=$(e).attr("namename")){var n;n=(n=$(e).attr("namename")).replace(/(\d+)/g,t)}$(e).attr("name",n)}),$('.custabcons[tab="'+e+'"]').find(".addcopydel table tbody tr").each(function(a,e){$(e).find('[name$=".lineNo"]').val(parseFloat($(e).index())+1),$(e).find('[name$=".lineNo"]').attr("value",parseFloat($(e).index())+1)})})}}t.find("td").each(function(a,e){var t=$(e).closest("tr").index(),n=$(e).find("input").attr("name")||$(e).find("select").attr("name")||$(e).find("input").attr("namename");if(void 0!=n){var i=n.split("[")[1].split("]")[0];if(-1==[top.languageInit.allLanguage.productionMaterialUse,top.languageInit.allLanguage.checkInfo,top.languageInit.allLanguage.sn].indexOf($(this).closest(".custabcons").attr("tab")))var l=n.replace(new RegExp(i,"g"),t);else if($(e).find(".aedbtns").length>0)l=n.replace(new RegExp("\\d","g"),t);else l=n.replace(new RegExp("(\\d)(\\W+)(\\w+)(\\W+)\\d","g"),"$1$2$3$4"+t)}$(e).find(".aedbtns").length>0?$(e).find("input").attr("namename",l):$(e).find("input").attr("name",l),-1!=n.indexOf("lineNo")&&($(e).find("input").val(parseFloat(t)+1),$(e).find("input").attr("value",parseFloat(t)+1))})})}function menulevel(){$(document).on("mouseleave",".menulevel",function(){$(this).find(".menulevelc").hide(),$(this).find(".menulevelc2").hide()}),$(document).on("hover",".menulevelt",function(){$(this).next().show()}),$(document).on("hover",".menulevelc1>li",function(){$(this).closest(".menulevelc1").find(".menulevelc2").hide();var a=$(this).find(".menulevelc2");a.show(),a.css({"margin-top":"-30px"})})}function addEditDelJsplumb(){$("#addeditbaseProcessRoute").click(function(){var a=srcurl();top.layer.open({type:2,id:"jsPlumb",title:top.languageInit.allLanguage.newProcess,shadeClose:!1,area:["1000px","600px"],content:a+"JsPlumb/jsplumb.html",btn:[top.languageInit.allLanguage.setSure,top.languageInit.allLanguage.cancelSet],yes:function(a,e){var t=e.find("iframe").contents().find(".layui-inline");if(!formcheck.check(0,t))return!1;e.find("iframe").contents().find("#saveDrawing").click();top.layer.close(a)},end:function(a,e){top.layer.close(a),$(".custabcons .revertDisabled").attr("disabled",!0)},zIndex:1001})}),$("#delbaseProcessRoute").click(function(){top.layer.confirm(top.languageInit.allLanguage.sureToDeleteProcess,{title:top.languageInit.allLanguage.tips,btn:[top.languageInit.allLanguage.setSure,top.languageInit.allLanguage.cancelSet]},function(a,e){var t;(t=top.$("#admin-body iframe:visible").contents()).find('.custabcons[tab="'+top.languageInit.allLanguage.processList+'"] table tbody tr:not(:first-child)').remove(),t.find('.custabcons[tab="'+top.languageInit.allLanguage.processList+'"] table tbody tr:first-child input').val(""),t.find('.custabcons[tab="'+top.languageInit.allLanguage.processList+'"] table tbody tr:first-child select').val(""),t.find('.custabcons[tab="'+top.languageInit.allLanguage.processList+'"] table tbody tr:first-child').show(),t.find('.custabcons[tab="'+top.languageInit.allLanguage.outProcessInfo+'"] .layui-form-item:not(:first-child)').remove(),t.find('.custabcons[tab="'+top.languageInit.allLanguage.outProcessInfo+'"] .layui-form-item:first-child input').val(""),t.find('.custabcons[tab="'+top.languageInit.allLanguage.outProcessInfo+'"] .layui-form-item:first-child').show(),t.find('.custabcons[tab="样式信息"] .layui-form-item:not(:first-child)').remove(),t.find('.custabcons[tab="样式信息"] .layui-form-item:first-child input').val(""),t.find('.custabcons[tab="样式信息"] .layui-form-item:first-child').show(),t.find('.custabcons[tab="连线信息"] ').find('[class$="Connection"]').empty(),top.layer.close(a)},function(a,e){top.layer.close(a)})})}function implementation(){$("#implementation").click(function(){var a=$(this).attr("parmId"),e=top.$("#admin-body iframe:visible").attr("src");if($("#list").length>0)var t=rowData($(this));if(0==t)return!1;if($("#list").length>0)var n=t[""+a];else{var i=pagekeyText(),l=localStorage.getItem(i);n=JSON.parse(l)[0].mainId}if(-1!=e.indexOf("startReport"))var o=top.languageInit.allLanguage.orderProcess,r="startReport";else if(-1!=e.indexOf("completeReport"))o=top.languageInit.allLanguage.orderProcess,r="completeReport";else if(-1!=e.indexOf("startEdit"))o=top.languageInit.allLanguage.orderProcess,r="startEdit";else if(-1!=e.indexOf("completeEdit"))o=top.languageInit.allLanguage.orderProcess,r="completeEdit";else if(-1!=e.indexOf("productionExecution/search"))o=top.languageInit.allLanguage.orderProcess,r="productionExecution";else if(-1!=e.indexOf("flowCard"))o=top.languageInit.allLanguage.viewFlowcardExeinfo,r="flowCard";else if(-1!=e.indexOf("productionOutSourceAccount/search"))o=top.languageInit.allLanguage.generateFlowCardImplementation,r="productionOutSourceAccount";else if(-1!=e.indexOf("OutSourcesReceiveSearch"))o=top.languageInit.allLanguage.orderProcess,r="productionOutSourcesReceive";else if(-1!=e.indexOf("OutSourcesSendSearch"))o=top.languageInit.allLanguage.orderProcess,r="productionOutSourcesSend";var s=srcurl();top.layer.open({type:2,title:o,shadeClose:!0,area:["1000px","600px"],content:s+"JsPlumb/jsplumb.html?"+n+"/"+r,btn:[top.languageInit.allLanguage.setSure,top.languageInit.allLanguage.cancelSet],yes:function(a,e){top.layer.close(a)},btn2:function(a,e){top.layer.close(a)}})})}function dateCharge(a,e){return!(new Date(a.replace(new RegExp("-","g"),"/"))>new Date(e.replace(new RegExp("-","g"),"/")))}function periodDateTime(a,e,t){return""==a&&(a="1000-01-01"),""==e&&(e="9999-12-31"),new Date(a).getTime()-288e5<=new Date(t).getTime()&&new Date(t).getTime()<=new Date(e).getTime()+57599e3}function periodDateN(a,e){var t="";$('.custabcons[tab="工作时段"] table tbody tr').each(function(a,e){""!=$(e).find("[name$='startDate']").val()&&(periodDateTime(startDateTime,endDateTime,datetime)||(t+=top.languageInit.allLanguage.first+(a+1)+top.languageInit.allLanguage.startTimeNotBetweenEffectiveAndExpiration+"<br/>",$(e).find("[name$='startDate']").val("")));""!=$(e).find("[name$='endDate']").val()&&(periodDateTime(startDateTime,endDateTime,datetime)||(t+=top.languageInit.allLanguage.first+(a+1)+top.languageInit.allLanguage.endTimeNotBetweenEffectiveAndExpiration+"<br/>",$(e).find("[name$='endDate']").val("")))}),""!=t&&top.layer.alert(t,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info})}function effExpDate(){$(document).on("change",'input[name$="ffectiveDate"]',function(){var a=$(this).val(),e=$("input[name$='xpiryDate']").val();if($(this).closest("td").length>0&&(e=$(this).closest("tr").find("input[name$='xpiryDate']").val()),!dateCharge(a,e))return top.layer.alert(top.languageInit.allLanguage.effectiveCannoGreaterThanExpiration,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e)}),$(document).on("change",'input[name$="xpiryDate"]',function(){var a=$(this).val(),e=$("input[name$='ffectiveDate']").val();if($(this).closest("td").length>0&&(e=$(this).closest("tr").find("input[name$='ffectiveDate']").val()),!dateCharge(e,a))return top.layer.alert(top.languageInit.allLanguage.effectiveCannoGreaterThanExpiration,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e)})}function startEndDate(){$(document).on("change",'td input[name$="startDate"]:not(.timepicker)',function(){var a=$(this).val(),e=$(this).closest("tr").find("input[name$='endDate']").val();if(e)return dateCharge(a,e)?void 0:(top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanEnd,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e))}),$(document).on("change",'td input[name$="endDate"]:not(.timepicker)',function(){var a=$(this).val(),e=$(this).closest("tr").find("input[name$='startDate']").val();if(!dateCharge(e,a))return top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanEnd,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e)}),$(document).on("change",'input[name$="tartTime"]',function(){var a=$(this).val(),e=$(this).closest("tr").find("input[name$='ndTime']").val();if(!dateCharge(a,e))return top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanEnd,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e)}),$(document).on("change",'input[name$="ndTime"]',function(){var a=$(this).val(),e=$(this).closest("tr").find("input[name$='tartTime']").val();if(!dateCharge(e,a))return top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanEnd,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(e)})}function dateCheck(){$(document).on("change",'.layui-form-item input[name$=".startDate"]',function(){var a=$(this),e=$(this).val(),t=$(this).closest("form").find("input[name$='.completedDate']").first().val();if(t){var n=dateCharge(e,t);if(!n)return top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanCompletion,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(t);$(this).closest("form").find('td input[name$=".startDate"]').each(function(t,i){var l=$(i).val();if(l)return(n=dateCharge(e,l))?void 0:(top.layer.alert(top.languageInit.allLanguage.startTimeCannotGreaterThanStartInProcess,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(a).val(""))})}}),$(document).on("change",'.layui-form-item input[name$=".completedDate"]',function(){var a=$(this),e=$(this).val(),t=$(this).closest("form").find("input[name$='.startDate']").first().val();if(t){var n=dateCharge(t,e);if(!n)return top.layer.alert(completionDateCannotLessThanStartTime,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(top.languageInit.allLanguage.completedDate);$(this).closest("form").find('td input[name$=".completedDate"]').each(function(t,i){var l=$(i).val();if(l)return(n=dateCharge(l,e))?void 0:(top.layer.alert(top.languageInit.allLanguage.completionTimeCannotLessThanCompletionTimeInProcess,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(a).val(""))})}}),$(document).on("change",'.addcopydel input[name$=".startDate"]:not(.timepicker)',function(){var a=$(this).val(),e=$(this).closest("form").find("input[name$='.startDate']").first().val();if(e){if(!(n=dateCharge(e,a)))return top.layer.alert(top.languageInit.allLanguage.startUpTimeGreaterThanStartUpTimeInBasic,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val("");var t=$(this).closest("tr").find("input[name$='.completedDate']:not(.timepicker)").first().val();if(t){var n=dateCharge(a,t);return n?void 0:(top.layer.alert(top.languageInit.allLanguage.processStartUpTimeLessThanProcessCompletionTime,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(t))}}else top.layer.alert(top.languageInit.allLanguage.setStartTimeInBasicInformationFirst,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info})}),$(document).on("change",'.addcopydel input[name$=".completedDate"]',function(){var a=$(this).val(),e=$(this).closest("form").find("input[name$='.completedDate']").first().val();if(e){if(!(n=dateCharge(a,e)))return top.layer.alert(top.languageInit.allLanguage.completionTimeOfProcessLessThanCompletionTimeInBasic,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(a);var t=$(this).closest("tr").find("input[name$='.startDate']").first().val();if(t){var n=dateCharge(t,a);return n?void 0:(top.layer.alert(top.languageInit.allLanguage.processCompletionTimeGreaterThanProcessStartUpTime,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),void $(this).val(a))}}else top.layer.alert(top.languageInit.allLanguage.setCompletionTimeInBasicFirst,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info})})}function datedifference(a,e){var t;return a=Date.parse(a),t=(e=Date.parse(e))-a,t=Math.abs(t),Math.floor(t/864e5)}function cusTimeSheetS2(a){var e=0;a.closest("form").find("table tbody tr").each(function(a,t){var n=Number($(t).find('[name$="workingHours"]').val());""==n&&(n=0),e+=n}),e>24&&(top.layer.alert(top.languageInit.allLanguage.moreThan24Hours,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),e-=a.closest("tr").find('[name$="workingHours"]').val(),a.val(""),a.closest("tr").find('[name$="workingHours"]').val("")),a.closest("form").find('.layui-form-item [name$="workingHours"]').val(e)}function cusTimeSheet(){$(document).on("change",'.timepicker[name$=".startDate"], .timepicker[name$=".endDate"]',function(){var a=$(this),e=periodTime(a);$.isEmptyObject(e)?(!function(a){var e=a.closest("tr").find('[name$="startDate"]').val(),t=a.closest("tr").find('[name$="endDate"]').val();if(""==e||""==t)return!1;(e=Number(e.replace(":",".")))>=(t=Number(t.replace(":",".")))&&(t+=24);var n=(t-e).toFixed(2);n=Number(n.split(".")[0]+"."+(10*n.split(".")[1]/6).toFixed(0)).toFixed(2),a.closest("tr").find('[name$="workingHours"]').val(n)}(a),cusTimeSheetS2(a)):(top.layer.msg(top.languageInit.allLanguage.timeYouChoose+e+top.languageInit.allLanguage.intersectionOfLineTime),$(this).val(""))})}function periodTime(a){var e=-1!=a.attr("name").indexOf("startDate")?"startDate":"endDate",t="startDate"==e?"endDate":"startDate",n=a.closest("tbody").find("tr"),i=a.closest("tr").index(),l=[];return n.each(function(o,r){var s=$(n[0]).find('[name$="startDate"]').val(),d=$(r).find('[name$="startDate"]').val(),u=$(r).find('[name$="endDate"]').val(),c=a.closest("tr").find("[name$="+t+"]").val(),f=a.val();o!=i&&""!=d&&""!=u&&""!=f&&(d=parseFloat(d.replace(":",".")),u=parseFloat(u.replace(":",".")),f=parseFloat(f.replace(":",".")),s=parseFloat(s.replace(":",".")),0!=o&&(d=d<=s?d+24:d),u=u<=s?d+24:d,f=f<=s?f+24:f,""!==c&&(c=(c=parseFloat(c.replace(":",".")))<=s?c+24:c,"endDate"==e&&f<=c&&(f+=24),(c<d&&f>d||c>u&&f<u)&&l.push(o+1)),d<f&&f<u&&l.push(o+1))}),l}function dataSizeChange(){$('[name="QcCheckList.dataSize"]').change(function(){3==$(this).val()?($("button.back").attr("disabled","disabled"),$("button.back").addClass("layui-btn-disabled")):($("button.back").removeAttr("disabled"),$("button.back").removeClass("layui-btn-disabled"))})}function proportionQuantity(a){$(document).on("keyup","."+a,function(){$(this);var e=$(this).val(),t=$(this).closest("tr"),n=t.find("."+a.split("N")[0]).val(),i=t.find(".basicUnit").val(),l=t.find(".inventoryUnit").val(),o=t.find(".stockAuxiliary").val(),r=t.find(".productionUnit").val();if(""==n)return top.layer.alert(top.languageInit.allLanguage.pleaseChooseMaterialNo+"！",{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),$(this).val(""),!1;n==i?t.find(".basicUnitN").val(e):n==l?t.find(".inventoryUnitN").val(e):n==o?t.find(".stockAuxiliaryN").val(e):n==r&&t.find(".productionUnitN").val(e);var s=t.find('[name$="scale"]').val(),d=JSON.parse(s);$.each(d,function(a,i){$.each(Object.keys(i),function(a,l){var o=l.split(".")[0]+".";if(n==i[o+"transformUnit"]){var r=i[o+"baseUnitNum"]/i[o+"transformUnitNum"]*e;t.find(".basicUnitN").val(r)}}),$.each(Object.keys(i),function(a,e){var n=e.split(".")[0]+".",s=t.find(".basicUnitN").val();if(l==i[n+"transformUnit"]){var d=i[n+"transformUnitNum"]/i[n+"baseUnitNum"]*s;t.find(".inventoryUnitN").val(d)}else if(o==i[n+"transformUnit"]){d=i[n+"transformUnitNum"]/i[n+"baseUnitNum"]*s;t.find(".stockAuxiliaryN").val(d)}else if(r==i[n+"transformUnit"]){d=i[n+"transformUnitNum"]/i[n+"baseUnitNum"]*s;t.find(".productionUnitN").val(d)}})})})}function unitConversion(a,e){function t(a,e,t){var n=a.closest("tr").find(".basicUnit").val(),i=a.closest("tr").find(".inventoryUnit").val(),l=a.closest("tr").find(".stockAuxiliary").val(),o=a.closest("tr").find(".productionUnit").val();if(void 0!=n){var r=e[0].split("-")[2];void 0==e[0]&&(r="00"),void 0!=i&&""==e[0]&&n==i&&(e[0]="1.0-1.0-"+r),void 0!=l&&""==e[1]&&n==l&&(e[1]="1.0-1.0-"+r),void 0!=o&&""==e[2]&&n==o&&(e[2]="1.0-1.0-"+r)}return e}$(document).on("focus","."+a,function(){var n=$(this).closest("tr").find('[name$="scale"]').val().split("&"),i=$(this);n=t(i,n);var l=i.closest("tr").find(".basicUnit"),o=i.closest("tr").find(".inventoryUnit"),r=i.closest("tr").find(".stockAuxiliary"),s=i.closest("tr").find(".productionUnit"),d=a.split("N")[0];if(d=i.closest("tr").find("."+d),-1==n[0].indexOf("-")||-1==n[1].indexOf("-")||-1==n[2].indexOf("-")){var u="";-1==n[e].indexOf("-")&&d.val()!=l.val()&&(u+=top.languageInit.allLanguage.quantityAndBasicUnit+"<br/>"),-1==n[0].indexOf("-")&&0!=e&&o.length>0&&d.val()!=o.val()&&(u+=top.languageInit.allLanguage.inventoryAndBasicUnit+"<br/>"),-1==n[1].indexOf("-")&&1!=e&&r.length>0&&d.val()!=r.val()&&(u+=top.languageInit.allLanguage.stockAuxiliaryAndBasicUnit+"<br/>"),-1==n[2].indexOf("-")&&2!=e&&s.length>0&&d.val()!=s.val()&&(u+=top.languageInit.allLanguage.productionAndBasicUnit+"<br/>"),top.layer.msg(u,{time:3e3})}}),$(document).on("keyup","."+a,function(){var n,i,l=$(this).val(),o=$(this).closest("tr"),r=o.find('[name$="scale"]').val().split("&");r=t($(this),r);var s=a.split("N")[0];changeUnitUnitV=o.find("."+s).val();var d=o.find(".basicUnit"),u=o.find(".baseNameN"),c=o.find(".inventoryUnit"),f=o.find(".inventoryUnitN"),g=o.find(".stockAuxiliary"),m=o.find(".stockAuxiliaryN"),p=o.find(".productionUnit"),v=o.find(".productionUnitN");changeUnitUnitV==d.val()&&"baseName"!=s&&u.val(l),changeUnitUnitV==c.val()&&"inventoryUnit"!=s&&f.val(l),changeUnitUnitV==g.val()&&"stockAuxiliary"!=s&&m.val(l),changeUnitUnitV==p.val()&&"productionUnit"!=s&&v.val(l),$.each(r,function(a,t){if(-1!=t.indexOf("-")&&a==e){var r=t.split("-"),s=r[0],d=r[1],u=r[2],c=r[3];u=unitPrecision(o.find(".basicUnit").val());"NaN"==(i="00"==u?s*l/d:(s*l/d).toFixed(u))&&(i=""),o.find(".basicUnitN").val(i),2==c&&o.find(".basicUnitN").removeAttr("readonly"),n="true"}}),"true"==n&&$.each(r,function(t,n){if(-1!=n.indexOf("-")&&t!=e){var l=n.split("-"),r=l[0],s=l[1],d=l[2],u=l[3];d=unitPrecision(closestObj.find("."+a).val());if(0==t&&void 0!=i){if("00"==d)var c=s*i/r;else c=(s*i/r).toFixed(d);o.find(".inventoryUnitN").val(c),2==u&&o.find(".inventoryUnitN").removeAttr("readonly")}else if(1==t&&void 0!=i){if("00"==d)var f=s*i/r;else f=(s*i/r).toFixed(d);o.find(".stockAuxiliaryN").val(f),2==u&&o.find(".stockAuxiliaryN").removeAttr("readonly")}else if(2==t&&void 0!=i){if("00"==d)var g=s*i/r;else g=(s*i/r).toFixed(d);o.find(".productionUnitN").val(g),2==u&&o.find(".productionUnitN").removeAttr("readonly")}}})})}function editParm1(){return top.$("#admin-body iframe:visible").attr("src").split(".html?")[1].split("/")[1]}function editParm2(){return top.$("#admin-body iframe:visible").attr("src").split(".html?")[1].split("/")[0]}function editParm3(){return top.$(".layui-layer").eq(0).find("iframe").attr("src").split(".html?")[1].split("&")[0]}function editParm4(){return top.$(".layui-layer").eq(0).find("iframe").attr("src").split(".html?")[1].split("&")[1]}function editParm5(){return top.$(".layui-layer").eq(0).find("iframe").attr("src").split(".html?")[1].split("&")[2]}function editBtn(a,e,t){var n=top.$("#admin-body iframe:visible").attr("data-index"),i=JSON.parse(localStorage.getItem("dataParmJsonArr"+n))[0].mainId;e=e+"?"+i;n=top.$("li.layui-this:visible").attr("lay-id");n+=t,"委外结算新增"==t&&localStorage.setItem(n,$('[name$="ProductionOutSourcesReceive.qualityQuantity"]').val()),"生产入库单新增"==t?$.ajax({url:testDomainName+"/api-p/ProductionOutSourcesReceive/dataValidate/"+i,type:"post",async:!1,contentType:"application/text; charset=utf-8",success:function(a){if("string"==typeof a&&(a=JSON.parse(a)),"200"!=a.header.status)return top.layer.alert(a.header.statusContent,{title:allLanguage.info,btn:[allLanguage.sure]}),!1;top.$(".tabnewtab").removeAttr("data-url"),top.$(".tabnewtab").removeAttr("lay-id"),top.$(".tabnewtab").attr("data-url",e),top.$(".tabnewtab").attr("lay-id",n),top.$(".tabnewtab").text(t),top.$(".tabnewtab").click()},error:function(){}}):(top.$(".tabnewtab").removeAttr("data-url"),top.$(".tabnewtab").removeAttr("lay-id"),top.$(".tabnewtab").attr("data-url",e),top.$(".tabnewtab").attr("lay-id",n),top.$(".tabnewtab").text(t),top.$(".tabnewtab").click())}function openTab(a,e){var t=top.$("li.layui-this:visible").attr("lay-id");t+=e,top.$(".tabnewtab").removeAttr("data-url"),top.$(".tabnewtab").removeAttr("lay-id"),top.$(".tabnewtab").attr("data-url",a),top.$(".tabnewtab").attr("lay-id",t),top.$(".tabnewtab").text(e),top.$(".tabnewtab").click()}function localStorageUnitPrecision(){$.ajax({url:testDomainName+"/api-bd/common1/getBaseUnit",type:"get",dataType:"json",contentType:"application/json",async:!1,success:function(a){if("string"==typeof a&&(a=JSON.parse(a)),200==a.header.status){var e=a.body;localStorage.setItem("unitPrecision",JSON.stringify(e))}},error:function(){}})}function unitPrecision(a){var e,t=localStorage.getItem("unitPrecision"),n=JSON.parse(t);return $.each(n,function(t,n){n.unit==a&&(e=n.accuracy)}),e}function readyUnitPrecision(){$('[datatype="'+top.languageInit.allLanguage.number+'"]').each(function(a,e){if(""!=$(e).val()){var t=$(e).attr("associatedunit");if(0!=$(e).closest("td").length){var n=unitPrecision($(e).closest("tr").find('[name$="'+t+'"]').val());$(e).val(parseFloat($(e).val()).toFixed(n))}}})}function namePointerLength(a){return a.match(/\./g).length}function nameType(a,e){var t="",n=a.split(".")[namePointerLength(a)],i=e.split(".")[namePointerLength(e)];return 0!=$(".layui-input-inline").find('[name$="'+i+'"]').length?t="noTd":0!=$('[name$="'+n+'"]').closest("tr").find('[name$="'+i+'"]').length?t="thisTr":0!=$("td").find('[name$="'+i+'"]').length&&1==namePointerLength(e)?t="otherTr":0!=$("td").find('[name$="'+i+'"]').length&&2==namePointerLength(e)&&(t="otherTable"),t}function readyCalculation(name,inputType,json){console.log(name),console.log(inputType),console.log(json),void 0==name&&(name="ProductionWorkOrderDetail.productionQuantity"),void 0==json&&(json={formula:"ProductionWorkOrderDetail.ProductionMaterialUse.dRequiedQuantity=((ProductionWorkOrderDetail.ProductionMaterialUse.dQuantitiesMolecule/ProductionWorkOrderDetail.ProductionMaterialUse.dQuantitiesDenominator)*ProductionWorkOrderDetail.productionQuantity+ProductionWorkOrderDetail.ProductionMaterialUse.dInvariableLoss)*(1+ProductionWorkOrderDetail.ProductionMaterialUse.dInvariableLossPerc)"});var suffix=name.split(".")[namePointerLength(name)];function fnfn(obj){var formula=json.formula.split("=")[1],formulaNew=formula.replace(/[.a-zA-Z]+/gi,function(a){var e=a.split(".")[namePointerLength(a)],t=nameType(name,a);return"noTd"==t?parseFloat($(".layui-input-inline").find('[name$="'+e+'"]').val()):"thisTr"==t?parseFloat(obj.closest("tr").find('[name$="'+e+'"]').val()):"otherTr"==t?(e=obj.closest(".addcopydel").attr("name")+"."+e,parseFloat($('[name$="'+e+'"]').val())):void 0}),calcNum=eval(formulaNew),resultName=json.formula.split("=")[0],resultNameSuffix=resultName.split(".")[namePointerLength(resultName)],objType=nameType(name,resultName);if("noTd"==objType)$(".layui-input-inline").find('[name$="'+resultNameSuffix+'"]').val(calcNum);else if("thisTr"==objType)obj.closest("tr").find('[name$="'+resultNameSuffix+'"]').val(calcNum);else if("otherTr"==objType){var tableIndex=obj.closest(".addcopydel").attr("name");resultNameSuffix=tableIndex+"."+resultNameSuffix,$('[name$="'+resultNameSuffix+'"]').val(calcNum)}}$('[name$="'+suffix+'"]').on("keyup",function(){fnfn($(this))})}function pageButtonInit(a,e){return!1}function revertDisabled(){$("input:disabled").addClass("revertDisabled"),$("select:disabled").addClass("revertDisabled")}function enterPageNumber(){}function tableOpe(a,e){$(document).on("click","#delPro",function(){var a=$(".ui-template").val();if(a==top.languageInit.allLanguage.defaultPlan)return top.layer.msg(top.languageInit.allLanguage.programNoDelete),!1;var t=$(".ui-template option[value="+a+"]"),n="";1==t.attr("isDefault")&&(n=top.languageInit.allLanguage.thisProgramIsDefaultProgram+","),top.layer.alert(""+n+top.languageInit.allLanguage.sureDeleteprogram,function(a){var n=t.text().replace(top.languageInit.allLanguage.default1,""),i=e+n;$.ajax({type:"post",url:i,contentType:"application/text; charset=utf-8",async:!1,success:function(a){top.layer.msg(top.languageInit.allLanguage.deleteSuccess+"！");var e=top.$("iframe:visible").attr("src").split("?")[0];top.$("iframe:visible").attr("src",e+"?name="+top.languageInit.allLanguage.defaultPlan+"&nameVal="+top.languageInit.allLanguage.defaultPlan)}}),top.layer.close(a)})}),$(document).on("click","#setAsDefault",function(){var a=$(".ui-template").val();if(a==top.languageInit.allLanguage.defaultPlan)return top.layer.alert(top.languageInit.allLanguage.defaultPlanCannot,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;$(".ui-template option").attr("isDefault","0");$(".ui-template option[value="+a+"]").text();$(".ui-template option[value="+a+"]").attr("isDefault","1"),$("#fbox_list_template").trigger("click",["setAsDefault"])}),$(document).on("click","#fbox_list_template",function(e,t){var n=$(".ui-template").val();if(n==top.languageInit.allLanguage.defaultPlan&&$(".ui-template option").length>3)return top.layer.alert(top.languageInit.allLanguage.onlyTreeTemplatesAllowed,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),!1;if($("button[filterval]").length>0)var i=JSON.parse($("button[filterval]").attr("filterval"));else i=JSON.parse(parent.$("button[filterval]").attr("filterval"));var l={tableProgram:{},tableFilter:i,tableProperty:""},o=$(".ui-template option[value="+n+"]"),r=o.text().replace(top.languageInit.allLanguage.default1,""),s=o.attr("cusId"),d=o.attr("isDefault"),u=$(".opsel").val();function c(){var e=$(".query").text(),i=e.match(/\.(\w+)\s/g);null!=i&&$.each(i,function(a,t){var n=t,i=t.replace(/([A-Z]+)/g,function(a){return"_"+a.toLocaleLowerCase()});e=e.replace(new RegExp(n,"g"),i)}),l.tableProgram={id:s,name:r,isDefault:d,contant:{groupOp:u,rules:[]},contantSql:e},$(".searchLi").each(function(a,e){var t={field:$(e).find(".columns select").val(),op:$(e).find(".operators select").val(),data:$(e).find(".data .input-elm").val()};l.tableProgram.contant.rules.push(t)});var o="",c=0;$(".ui-jqgrid-htable thead th:visible").each(function(a,e){var t=$(e).attr("propertyId");"undefined"!=t&&(0==c?o+=t:o=o+","+t,c++)}),l.tableProperty=o,console.log(l),$.ajax({type:"post",url:a,contentType:"application/text; charset=utf-8",async:!1,data:JSON.stringify(l),success:function(a){top.layer.msg(top.languageInit.allLanguage.planSavedSuccessfully);var e=top.$("iframe:visible").attr("src");if(n==top.languageInit.allLanguage.defaultPlan){var i=Number($(".ui-template option").length)-1;-1!=e.indexOf("treesearch.html")?-1!=e.indexOf("pid")?(e=top.$("iframe:visible").contents().find("iframe:visible").attr("src").split("&")[0],top.$("iframe:visible").contents().find("iframe:visible").attr("src",e+"&name="+r+"&nameVal="+i)):(e=top.$("iframe:visible").contents().find("iframe:visible").attr("src").split("?")[0],top.$("iframe:visible").contents().find("iframe:visible").attr("src",e+"?name="+r+"&nameVal="+i)):(e=top.$("iframe:visible").attr("src").split("?")[0],top.$("iframe:visible").attr("src",e+"?name="+r+"&nameVal="+i))}void 0!=t&&top.$("iframe:visible").attr("src",""+e)}})}n==top.languageInit.allLanguage.defaultPlan?top.layer.prompt({title:top.languageInit.allLanguage.newProgramName,btn:[top.languageInit.allLanguage.sure,top.languageInit.allLanguage.cancelSet],formType:0},function(a,e){r=a,top.layer.close(e),c()}):c()})}function calculateOutSourcePrice(){$(document).on("keyup",'[name$="priceQualityQuantity"], [name$="priceIndustrialWasteQuantity"], [name$="priceMaterialWasteQuantity"],[name$="qualityPriceWithTax"],[name$="industrialWastePriceWithTax"],[name$="materialWastePriceWithTax"],[name$="taxRate"]',function(){!function(a){var e=a.closest("tr"),t=e.find('[name$="taxRate"]').val();-1!=t.indexOf("%")&&(t=.01*parseFloat(t));var n=e.find('[name$="qualityPriceWithTax"]').val(),i=e.find('[name$="industrialWastePriceWithTax"]').val(),l=e.find('[name$="materialWastePriceWithTax"]').val(),o=e.find('[name$="priceQualityQuantity"]').val(),r=e.find('[name$="priceIndustrialWasteQuantity"]').val(),s=e.find('[name$="priceMaterialWasteQuantity"]').val();if(""==a.val()||" "==a.val()||isNaN(a.val()))return top.layer.alert(top.languageInit.allLanguage.enterPositiveNumber+"！",{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),a.val(""),!1;if(parseFloat(o)>parseFloat(localStorage.getItem(top.$("#admin-body iframe:visible").attr("data-index"))))return top.layer.alert(top.languageInit.allLanguage.qualifiedNumberLimit+"！",{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),a.val(""),!1;t=""==t?0:t,n=""==n?0:n,i=""==i?0:i,l=""==l?0:l,o=""==o?0:o,r=""==r?0:r,s=""==s?0:s;var d=e.find('[name$="qualityPriceNoTax"]'),u=e.find('[name$="industrialWastePriceNoTax"]'),c=e.find('[name$="materialWastePriceNoTax"]'),f=e.find('[name$="amountWithTax"]'),g=e.find('[name$="amountNoTax"]'),m=e.find('[name$="taxAmount"]'),p=unitPrecision(e.find('[name$="priceUnit"]').val());d.val((n/(1+parseFloat(t))).toFixed(p)),u.val((i/(1+parseFloat(t))).toFixed(p)),c.val((l/(1+parseFloat(t))).toFixed(p)),f.val((parseFloat(n*o)+parseFloat(i*r)+parseFloat(l*s)).toFixed(p)),m.val((parseFloat(d.val()*t*o)+parseFloat(u.val()*t*r)+parseFloat(c.val()*t*s)).toFixed(p)),g.val((parseFloat(f.val())-parseFloat(m.val())).toFixed(p))}($(this)),financialInformation()})}function financialInformation(){var a=0,e=0,t=0;$(".addedit tbody tr").each(function(n,i){var l=$(i).find('[name$="taxAmount"]').val(),o=$(i).find('[name$="amountNoTax"]').val(),r=$(i).find('[name$="amountWithTax"]').val();a+=parseFloat(l),e+=parseFloat(o),t+=parseFloat(r)}),$('[name="ProductionOutSourcesAccountGeneral.totalTax"]').val(a),$('[name="ProductionOutSourcesAccountGeneral.totalAmountNoTax"]').val(e),$('[name="ProductionOutSourcesAccountGeneral.totalAmount"]').val(t)}function badQuantity(){$(document).on("keyup",'[name$="checkNoGoodNum"], [name$="noQualifiedNum"]',function(){var a=$(this).closest("tr").find('[name$="checkNoGoodNum"]').val(),e=$(this).closest("tr").find('[name$="noQualifiedNum"]').val();parseFloat(a)<parseFloat(e)&&(top.layer.alert(top.languageInit.allLanguage.badTestsLessThanBad,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),$(this).val(""))})}function samplingQuantity(){$(document).on("keyup",'[name$="checkNum"]',function(){if(""==$(this).closest("tr").find('[name$="qualityInspectionPlan"]').val())return!1;samplingScheme($(this),"input","keyup")}),$(document).on("change",'[name$="checkNum"]',function(){if(""==$(this).closest("tr").find('[name$="qualityInspectionPlan"]').val())return!1;samplingScheme($(this),"input")})}function samplingScheme(a,e,t){var n=a.val();if(""==n)return!1;var i=a.closest("tr").index(),l="";top.$("#admin-body iframe:visible").contents().find('.custabcons[tab="'+top.languageInit.allLanguage.checkInfo+'"]').find(".addcopydel").eq(i).find("table tbody tr").each(function(i,o){var r=$(o).find('[name$="spType"]').val(),s=$(o).find('[name$="sampleAmount"]').val();if(1!=r&&3!=r){if(0==r)$(o).find('[name$="samplingNum"]').val(n),$(o).find('[name$="samplingNum"]').attr("value",n);else if(2==r){var d=$(o).find('[name$="spBatchUp"]').val(),u=$(o).find('[name$="spBatchDown"]').val();parseInt(n)>=parseInt(u)&&parseInt(n)<=parseInt(d)?(s=.01*parseInt(s),$(o).find('[name$="samplingNum"]').val(n*s),$(o).find('[name$="samplingNum"]').attr("value",n*s)):"keyup"!=t&&("input"==e?(l+=top.languageInit.allLanguage.testNumberInfo+(i+1)+top.languageInit.allLanguage.samplingUpperAndLowerLimitNum+"<br/>",a.val("")):"back"==e&&(l+=top.languageInit.allLanguage.testNumberInfo+(i+1)+top.languageInit.allLanguage.samplingUpperAndLowerLimitPlan+"<br/>",$(o).find('[name$="samplingPlan"]').val("")))}}else $(o).find('[name$="samplingNum"]').val(s),$(o).find('[name$="samplingNum"]').attr("value",s)}),""!=l&&top.layer.alert(l,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info})}function positionStatus(){function a(a){1==a.val()?$(".addcopydel").show():$(".addcopydel").hide()}($(document).on("change",'[name$="positionStatus"]',function(){a($(this))}),$('[name$="positionStatus"]').length>0)&&a($('[name$="positionStatus"]'))}function thisDate(){if(-1!=window.frameElement.src.indexOf("add.html")||-1!=window.frameElement.src.indexOf("copy.html")){var a=new Date,e=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,t=a.getDate()<10?"0"+a.getDate():a.getDate(),n=a.getFullYear()+"-"+e+"-"+t;$('[name$=".docDate"]').val(n),$('[name$=".billDate"]').val(n)}}function batchNumberCheck(){$(document).on("change",'[name$=".batchNumber"]',function(){var a=$(this).val();if(""==a)return!1;var e=$(this),t=testDomainName+"/api-p/ProductionBatchNumberMainFile/checkBatchNumber/"+a;$.ajax({url:t,type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(a){"string"==typeof a&&(a=JSON.parse(a)),"608"==a.header.status&&(top.layer.alert(a.header.statusContent,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),e.val(""))},error:function(){alert(top.languageInit.allLanguage.occerFail)}})})}function receiveQuantity(){$(document).on("keyup",'[name$=".receiveQuantity"]',function(){if(""==$(this).val()||" "==$(this).val()||isNaN($(this).val()))return top.layer.alert(top.languageInit.allLanguage.enterPositiveNumber+"！",{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),$(this).val(""),!1;var a=$(this).closest(".custabcons").find('[name$="productionQuantity"]').val(),e=$(this).val();return parseFloat(a)-parseFloat(e)<0?(top.layer.alert(top.languageInit.allLanguage.receiveQuantityCannotGreaterThanProductionQuantity,{btn:[top.languageInit.allLanguage.sure],title:top.languageInit.allLanguage.info}),$(this).val(""),!1):void 0})}function firstTrSelect(){($('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"]').length>0||$('.custabcons[tab="'+top.languageInit.allLanguage.processList+'"]').length>0)&&($('.custabtits[tab="'+top.languageInit.allLanguage.detailInfo+'"]').closest(".custabtit").find(".custabtits:visible").length>1&&$('.custabcons[tab="'+top.languageInit.allLanguage.detailInfo+'"] table tbody tr:first-child .aedbtns').attr("checked",!0),$('.custabtits[tab="'+top.languageInit.allLanguage.processList+'"]').closest(".custabtit").find(".custabtits:visible").length)}function pagekeyText(){var a=top.$("#admin-body iframe:visible").attr("data-index");return 0!=top.$(".layui-layer:visible").length&&(a=top.$(".layui-layer:visible iframe").parent().attr("id")),"dataParmJsonArr"+a}function addPageAdd(){var a=top.$("#admin-body iframe:visible").attr("src").split("?")[0];top.$("#admin-body iframe:visible").attr("src",a)}function backPageParm(){var a=window.frameElement.src,e=a.substring(a.lastIndexOf("?")+1).split("&"),t="",n={};if(1==e.length)t=e[0];else{var i="",l="";$.each(e,function(a,e){"backKey"==e.split("=")[0]?t=e.split("=")[1]:(i=e.split("=")[0],l=e.split("=")[1],n[i]=l)})}return{backKey:t,jsonStr:n}}function staticTreeVal(a){a.val(localStorage.getItem(pagekeyText().replace("dataParmJsonArr","treeName")))}function isBath(){function a(){var a=$('[name$=".batchRuleName"]');0==$('select[name$=".isBath"]').val()?(a.next(".back").hide(),setTimeout(function(){a.closest(".layui-inline").removeClass("edit-inline")},0)):1==$('select[name$=".isBath"]').val()&&(a.next(".back").show(),setTimeout(function(){a.closest(".layui-inline").addClass("edit-inline")},0))}$('select[name$=".isBath"]').length>0&&a(),$(document).on("change",'select[name$=".isBath"]',function(){a()})}function isSn(){function a(){var a=$('[name$=".snRuleName"]');0==$('select[name$=".isSn"]').val()?(a.next(".back").hide(),setTimeout(function(){a.closest(".layui-inline").removeClass("edit-inline")},0)):1==$('select[name$=".isSn"]').val()&&(a.next(".back").show(),setTimeout(function(){a.closest(".layui-inline").addClass("edit-inline")},0))}$('select[name$=".isSn"]').length>0&&a(),$(document).on("change",'select[name$=".isSn"]',function(){a()})}function isOnlyIc(){var a=!0;return-1!=window.frameElement.src.indexOf("/staff/")&&(icCheckParams={cardNum:$('[name="BaseStaff.cardNum"]').val(),id:$('[name="BaseStaff.id"]').val()},$.ajax({type:"post",url:testDomainName+"/api-bd/BaseStaff/checkIC",contentType:"application/text; charset=utf-8",async:!1,data:JSON.stringify(icCheckParams),success:function(e){"string"==typeof e&&(e=JSON.parse(e)),"200"!=e.header.status&&(top.layer.alert(e.header.statusContent),a=!1)}})),a}function isSerialNumber(){if(-1!=window.frameElement.src.indexOf("/otherCodeRule/")){var a=[];return $("table.addedit tbody tr").each(function(e,t){a.push($(t).find('[name$=".type"]').val())}),!!a.some(a=>5==a)||(top.layer.alert("必须包含流水号！"),!1)}}layui.use("layer",function(){layui.layer}),$(document).ready(function(){if(datepickerDefaultValueObj($(document)),cusdatetimepicker(),localStorageUnitPrecision(),cusTimeSheet(),backClick(),cusTab(),onlyTr(),addCopyRow(),delrow(),menulevel(),effExpDate(),startEndDate(),addEditDelJsplumb(),implementation(),zkbg(),revertDisabled(),enterPageNumber(),dateCheck(),calculateOutSourcePrice(),badQuantity(),samplingQuantity(),positionStatus(),thisDate(),batchNumberCheck(),receiveQuantity(),(-1!=parent.$("iframe:visible").attr("src").indexOf("/add.html")||-1!=parent.$("iframe:visible").attr("src").indexOf("/edit.html")||-1!=parent.$("iframe:visible").attr("src").indexOf("/copy.html"))&&$(".opeBtn").length>0){$(".opeBtn").attr("id","opeBtn"),formAllBtn();var a=window.frameElement.src.match(/pages.+/)[0],e=auditApiGet(a);$(document).on("click",".addform, .copyform",function(){if(-1!=(t=window.frameElement.src).indexOf("/add.html")&&$(this).hasClass("addform")||-1!=t.indexOf("/copy.html")&&$(this).hasClass("copyform"))top.layer.confirm("是否要删除输入数据？",{btn:[top.languageInit.allLanguage.sure,top.languageInit.allLanguage.cancelSet],title:top.languageInit.allLanguage.info},function(a,e){window.location.reload(),top.layer.close(a)},function(a,e){});else{if($(this).hasClass("addform"))var a="add.html",e=allLanguage.add;else a="copy.html",e=allLanguage.copy;var t,n=(t=top.$("#admin-body iframe:visible").attr("src")).substring(0,t.lastIndexOf("/")+1)+a,i=top.$(".layui-tab-title .layui-this cite").text(),l=-1!=i.indexOf(allLanguage.add)?allLanguage.add:-1!=i.indexOf(allLanguage.update)?allLanguage.update:allLanguage.copy;if(e=i.split(l)[0]+e,$(this).hasClass("copyform")){var o=top.$("#admin-body iframe:visible").attr("data-index")+e;localStorage.removeItem("dataParmJsonArr"+o),localStorage.setItem("dataParmJsonArr"+o,JSON.stringify([{mainId:$('[name$=".id"]').val()}]))}openTab(n,e)}}),$(document).on("click",".submitform, .saveform, .submitformspe, .saveformspe",function(){if(""==$('[name$=".id"]').val()){if(-1!=top.$("#admin-body iframe:visible").attr("src").indexOf("/copy.html"))var a="copy";else a="create";$(this).hasClass("saveform")||$(this).hasClass("saveformspe")?type="create":($(this).hasClass("submitform")||$(this).hasClass("submitformspe"))&&(type="submit")}else{a="update";$(this).hasClass("saveform")||$(this).hasClass("saveformspe")?type="change":($(this).hasClass("submitform")||$(this).hasClass("submitformspe"))&&(type="submit")}var t=testDomainName+e.apiBase+e.baseName+"/"+a+"/"+type+"/"+e.endName;isStaticPage()?saveformspe(t):saveform(t)}),$(document).on("click",".unsubmitform, .auditform, .unauditform",function(){$(this).hasClass("unsubmitform")?type="unsubmit":$(this).hasClass("auditform")?type="audit":$(this).hasClass("unauditform")&&(type="unaudit");var a=testDomainName+e.apiBase+e.baseName+"/"+type+"/"+type+"/"+e.endName;saveformNoForm(a)}),$(document).on("click",".exitform",function(){closetab()}),$(document).on("click",".listform",function(){if(isTreeSearch())var a="treesearch.html";else a="search.html";var e=top.$("#admin-body iframe:visible").attr("src"),t=e.substring(0,e.lastIndexOf("/")+1)+a,n=top.$(".layui-tab-title .layui-this cite").text(),i=-1!=n.indexOf(allLanguage.add)?allLanguage.add:-1!=n.indexOf(allLanguage.update)?allLanguage.update:allLanguage.copy;openTab(t,n.split(i)[0]+allLanguage.list)})}});